var jd=Object.defineProperty;var kc=e=>{throw TypeError(e)};var Kd=(e,t,n)=>t in e?jd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var c=(e,t,n)=>Kd(e,typeof t!="symbol"?t+"":t,n),vc=(e,t,n)=>t.has(e)||kc("Cannot "+n);var Oc=(e,t,n)=>(vc(e,t,"read from private field"),n?n.call(e):t.get(e)),Ec=(e,t,n)=>t.has(e)?kc("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Ic=(e,t,n,r)=>(vc(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n);import{b as qd}from"./iframe-f7ju8_8X.js";import"./text-field-ptm-6TKg.js";import"./button-B8Ka1pL1.js";import"./preload-helper-Dp1pzeXC.js";import"./if-defined-em8Hxg-n.js";const Dd=e=>typeof e=="function",h=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(i){return t(i,n,r,s)}};case 5:return function(n,r,s,o,i){return arguments.length>=5?t(n,r,s,o,i):function(a){return t(a,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},Z=e=>e,_s=e=>()=>e,Tc=_s(!0),ko=_s(!1),qu=_s(void 0),Ud=qu;function m(e,t,n,r,s,o,i,a,u){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return i(o(s(r(n(t(e))))));case 8:return a(i(o(s(r(n(t(e)))))));case 9:return u(a(i(o(s(r(n(t(e))))))));default:{let l=arguments[0];for(let f=1;f<arguments.length;f++)l=arguments[f](l);return l}}}const fi=e=>(t,n)=>t===n||e(t,n),Bd=h(2,(e,t)=>fi((n,r)=>e(t(n),t(r)))),Jd=e=>fi((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}),Sr="effect/GlobalValue";let En;const j=(e,t)=>(En||(globalThis[Sr]??(globalThis[Sr]=new Map),En=globalThis[Sr]),En.has(e)||En.set(e,t()),En.get(e)),it=e=>typeof e=="string",Gt=e=>typeof e=="number",bs=e=>typeof e=="boolean",Ss=e=>typeof e=="bigint",vo=e=>typeof e=="symbol",Wn=Dd,Vd=e=>e===void 0,Hd=e=>!1,Du=e=>typeof e=="object"&&e!==null,zn=e=>Du(e)||Wn(e),A=h(2,(e,t)=>zn(e)&&t in e),Uu=h(2,(e,t)=>A(e,"_tag")&&e._tag===t),Lt=e=>e==null,Gd=e=>e!=null,Wd=e=>e instanceof Date,zd=e=>typeof e=="string"||A(e,Symbol.iterator),Yd=e=>Du(e)&&!Array.isArray(e),Qd=e=>A(e,"then")&&Wn(e.then),ws=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let Bu=class Ju{constructor(t){c(this,"self");c(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new Ju(this.self)}};const Xd=335903614,Zd=4150755663,em=1481765933,tm=1284865837,nm=9007199254740992,rm=134217728;class sm{constructor(t,n,r,s){c(this,"_state");return Lt(n)&&Lt(t)?(n=Math.random()*4294967295>>>0,t=0):Lt(n)&&(n=t,t=0),Lt(s)&&Lt(r)?(s=this._state?this._state[3]:Zd,r=this._state?this._state[2]:Xd):Lt(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),Fc(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*rm+n)/nm}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;om(this._state,t,n,em,tm),Fc(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,i=t>>>27,a=(-i>>>0&31)>>>0;return(o>>>i|o<<a)>>>0}}function om(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,i=(n&65535)*(s>>>16)>>>0,a=(n&65535)*(s&65535)>>>0,u=(n>>>16)*(s>>>16)+((i>>>16)+(o>>>16))>>>0;i=i<<16>>>0,a=a+i>>>0,a>>>0<i>>>0&&(u=u+1>>>0),o=o<<16>>>0,a=a+o>>>0,a>>>0<o>>>0&&(u=u+1>>>0),u=u+Math.imul(n,r)>>>0,u=u+Math.imul(t,s)>>>0,e[0]=u,e[1]=a}function Fc(e,t,n,r,s){let o=t+r>>>0;const i=n+s>>>0;i>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=i}const Oo=Symbol.for("effect/Utils/YieldWrap");var Gn;class Yn{constructor(t){Ec(this,Gn);Ic(this,Gn,t)}[Oo](){return Oc(this,Gn)}}Gn=new WeakMap;function im(e){if(typeof e=="object"&&e!==null&&Oo in e)return e[Oo]();throw new Error(ws("yieldWrapGet"))}const Me=j("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),Vu={effect_internal_function:e=>e()},cm={effect_internal_function:e=>{try{return e()}finally{}}};var Ga;const am=((Ga=Vu.effect_internal_function(()=>new Error().stack))==null?void 0:Ga.includes("effect_internal_function"))===!0,ye=am?Vu.effect_internal_function:cm.effect_internal_function,eo=j(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),N=Symbol.for("effect/Hash"),S=e=>{if(Me.enabled===!0)return 0;switch(typeof e){case"number":return di(e);case"bigint":return Y(e.toString(10));case"boolean":return Y(String(e));case"symbol":return Y(String(e));case"string":return Y(e);case"undefined":return Y("undefined");case"function":case"object":return e===null?Y("null"):e instanceof Date?Number.isNaN(e.getTime())?Y("Invalid Date"):S(e.toISOString()):e instanceof URL?S(e.href):um(e)?e[N]():hi(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},hi=e=>(eo.has(e)||eo.set(e,di(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),eo.get(e)),q=e=>t=>t*53^e,ks=e=>e&3221225471|e>>>1&1073741824,um=e=>A(e,N),di=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return ks(t)},Y=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return ks(t)},lm=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=m(Y(t[r]),q(S(e[t[r]])));return ks(n)},Hu=e=>lm(e,Object.keys(e)),Qn=e=>{let t=6151;for(let n=0;n<e.length;n++)t=m(t,q(S(e[n])));return ks(t)},W=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,N,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,N,{value(){return t},enumerable:!1}),t},R=Symbol.for("effect/Equal");function M(){return arguments.length===1?e=>Jr(e,arguments[0]):Jr(arguments[0],arguments[1])}function Jr(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(Vr(e)&&Vr(t))return S(e)===S(t)&&e[R](t)?!0:Me.enabled&&Me.tester?Me.tester(e,t):!1;if(e instanceof Date&&t instanceof Date){const r=e.getTime(),s=t.getTime();return r===s||Number.isNaN(r)&&Number.isNaN(s)}else if(e instanceof URL&&t instanceof URL)return e.href===t.href}if(Me.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>Jr(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&Jr(e[o],t[o])))return Me.tester?Me.tester(e,t):!1;return!0}}return Me.tester?Me.tester(e,t):!1}}return Me.enabled&&Me.tester?Me.tester(e,t):!1}const Vr=e=>A(e,R),mi=()=>M,G=Symbol.for("nodejs.util.inspect.custom"),se=e=>{try{if(A(e,"toJSON")&&Wn(e.toJSON)&&e.toJSON.length===0)return e.toJSON();if(Array.isArray(e))return e.map(se)}catch{return{}}return hm(e)},ue=e=>JSON.stringify(e,null,2),Wt=(e,t=2)=>{if(typeof e=="string")return e;try{return typeof e=="object"?Gu(e,t):String(e)}catch{return String(e)}},Gu=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&(kt.fiberRefs!==void 0&&Wu(o)?o[gi](kt.fiberRefs):o):o,t);return n=void 0,r},gi=Symbol.for("effect/Inspectable/Redactable"),Wu=e=>typeof e=="object"&&e!==null&&gi in e,kt=j("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),fm=(e,t)=>{const n=kt.fiberRefs;kt.fiberRefs=e;try{return t()}finally{kt.fiberRefs=n}},hm=e=>Wu(e)&&kt.fiberRefs!==void 0?e[gi](kt.fiberRefs):e,F=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},Cn="Async",vs="Commit",Je="Failure",to="OnFailure",Hr="OnSuccess",Gr="OnSuccessAndFailure",Ve="Success",zu="Sync",dm="Tag",Xn="UpdateRuntimeFlags",Wr="While",Mr="Iterator",Yu="WithRuntime",Nr="Yield",pi="RevertFlags";let mm="3.19.14";const yi=()=>mm,gm=Symbol.for("effect/Effect"),pm=Symbol.for("effect/Stream"),ym=Symbol.for("effect/Sink"),_m=Symbol.for("effect/Channel"),zt={_R:e=>e,_E:e=>e,_A:e=>e,_V:yi()},bm={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},Sm={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},Zn={[gm]:zt,[pm]:zt,[ym]:bm,[_m]:Sm,[R](e){return this===e},[N](){return W(this,hi(this))},[Symbol.iterator](){return new Bu(new Yn(this))},pipe(){return F(this,arguments)}},_i={[N](){return W(this,Hu(this))},[R](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&M(this[r],e[r])))return!1;return!0}},er={...Zn,_op:vs},wm={...er,..._i},km=(function(){function e(){}return e.prototype=er,e})(),Qu=Symbol.for("effect/Option"),Xu={...Zn,[Qu]:{_A:e=>e},[G](){return this.toJSON()},toString(){return ue(this.toJSON())}},vm=Object.assign(Object.create(Xu),{_tag:"Some",_op:"Some",[R](e){return Zu(e)&&tl(e)&&M(this.value,e.value)},[N](){return W(this,q(S(this._tag))(S(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:se(this.value)}}}),Om=S("None"),Em=Object.assign(Object.create(Xu),{_tag:"None",_op:"None",[R](e){return Zu(e)&&el(e)},[N](){return Om},toJSON(){return{_id:"Option",_tag:this._tag}}}),Zu=e=>A(e,Qu),el=e=>e._tag==="None",tl=e=>e._tag==="Some",nl=Object.create(Em),Eo=e=>{const t=Object.create(vm);return t.value=e,t},rl=Symbol.for("effect/Either"),sl={...Zn,[rl]:{_R:e=>e},[G](){return this.toJSON()},toString(){return ue(this.toJSON())}},Im=Object.assign(Object.create(sl),{_tag:"Right",_op:"Right",[R](e){return ol(e)&&cl(e)&&M(this.right,e.right)},[N](){return q(S(this._tag))(S(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:se(this.right)}}}),Tm=Object.assign(Object.create(sl),{_tag:"Left",_op:"Left",[R](e){return ol(e)&&il(e)&&M(this.left,e.left)},[N](){return q(S(this._tag))(S(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:se(this.left)}}}),ol=e=>A(e,rl),il=e=>e._tag==="Left",cl=e=>e._tag==="Right",Fm=e=>{const t=Object.create(Tm);return t.left=e,t},$m=e=>{const t=Object.create(Im);return t.right=e,t},re=$m,L=Fm,ae=il,ht=cl,Rm=h(2,(e,t)=>ae(e)?L(t(e.left)):re(e.right)),Mm=h(2,(e,{onLeft:t,onRight:n})=>ae(e)?t(e.left):n(e.right)),Nm=Mm({onLeft:Z,onRight:Z}),Am=h(2,(e,t)=>{if(ht(e))return e.right;throw t(e.left)}),al=e=>e.length>0,ul=e=>(t,n)=>t===n?0:e(t,n),Cm=ul((e,t)=>e<t?-1:1),ll=h(2,(e,t)=>ul((n,r)=>e(t(n),t(r)))),Pm=e=>h(2,(t,n)=>e(t,n)===1),w=()=>nl,E=Eo,oe=el,me=tl,Qe=h(2,(e,{onNone:t,onSome:n})=>oe(e)?t():n(e.value)),he=h(2,(e,t)=>oe(e)?t():e.value),zr=h(2,(e,t)=>oe(e)?t():e),xm=h(2,(e,t)=>oe(e)?E(t()):e),Os=e=>e==null?w():E(e),rt=he(qu),Lm=e=>(...t)=>{try{return E(e(...t))}catch{return w()}},jm=h(2,(e,t)=>{if(me(e))return e.value;throw t()}),Km=jm(()=>new Error("getOrThrow called on a None")),qm=h(2,(e,t)=>oe(e)?w():E(t(e.value))),tr=h(2,(e,t)=>oe(e)?w():t(e.value)),Dm=tr,Um=e=>h(2,(t,n)=>oe(t)?!1:e(t.value,n)),Bm=mi(),Jm=Um(Bm),Vm=h(2,(e,t)=>oe(e)?!1:t(e.value)),$c=e=>(t,n)=>oe(t)?n:oe(n)?t:E(e(t.value,n.value)),Hm=(...e)=>e,Es=e=>new Array(e),Gm=h(2,(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r}),Q=e=>Array.isArray(e)?e:Array.from(e),Wm=e=>Array.isArray(e)?e:[e],zm=h(2,(e,{onEmpty:t,onNonEmpty:n})=>le(e)?n(_e(e),Tt(e)):t()),Yr=h(2,(e,t)=>[t,...e]),Ym=h(2,(e,t)=>[...e,t]),fl=h(2,(e,t)=>Q(e).concat(Q(t))),Io=Array.isArray,Qm=e=>e.length===0,Xm=Qm,Ar=al,le=al,hl=(e,t)=>e<0||e>=t.length,Zm=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),eg=h(2,(e,t)=>{const n=Math.floor(t);return hl(n,e)?w():E(e[n])}),dl=h(2,(e,t)=>{const n=Math.floor(t);if(hl(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),Pn=eg(0),_e=dl(0),tg=e=>le(e)?E(ml(e)):w(),ml=e=>e[e.length-1],Tt=e=>e.slice(1),ng=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},rg=h(2,(e,t)=>cg(e,ng(e,t))),sg=h(2,(e,t)=>{const n=Q(e);return n.slice(Zm(t,n),n.length)}),Rc=e=>Array.from(e).reverse(),jn=h(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),Mc=h(2,(e,t)=>og(e,t,Hm)),og=h(3,(e,t,n)=>{const r=Q(e),s=Q(t);if(le(r)&&le(s)){const o=[n(_e(r),_e(s))],i=Math.min(r.length,s.length);for(let a=1;a<i;a++)o[a]=n(r[a],s[a]);return o}return[]}),ig=mi(),cg=h(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return le(n)?r>=1?ag(n,r):[[],n]:[n,[]]}),ag=h(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[Nn(e),[]]:[Yr(e.slice(1,n),_e(e)),e.slice(n)]}),Nn=e=>e.slice(),ug=h(3,(e,t,n)=>{const r=Q(e),s=Q(t);return le(r)?le(s)?yl(n)(fl(r,s)):r:s}),Cr=h(2,(e,t)=>ug(e,t,ig)),Yt=()=>[],qe=e=>[e],Bt=h(2,(e,t)=>e.map(t)),gl=h(2,(e,t)=>{if(Xm(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),lg=gl(Z),fg=h(2,(e,t)=>{const n=Q(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);me(o)&&r.push(o.value)}return r}),pl=h(3,(e,t,n)=>Q(e).reduce((r,s,o)=>n(r,s,o),t)),Nc=(e,t)=>{const n=[];let r=e,s;for(;me(s=t(r));){const[o,i]=s.value;n.push(o),r=i}return n},bi=Jd,yl=h(2,(e,t)=>{const n=Q(e);if(le(n)){const r=[_e(n)],s=Tt(n);for(const o of s)r.every(i=>!t(o,i))&&r.push(o);return r}return[]}),hg=e=>yl(e,mi()),gn=h(2,(e,t)=>Q(e).join(t)),Qt=Cm,To=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),_l=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return _l(e,t.from)}},Pr=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),bl=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},dg=e=>{try{return e.toISOString()}catch{return String(e)}},Xt=e=>{if(it(e))return JSON.stringify(e);if(Gt(e)||e==null||bs(e)||vo(e))return String(e);if(Wd(e))return dg(e);if(Ss(e))return String(e)+"n";if(!Io(e)&&A(e,"toString")&&Wn(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();try{return JSON.stringify(e),Io(e)?`[${e.map(Xt).join(",")}]`:`{${Pr(e).map(t=>`${it(t)?JSON.stringify(t):String(t)}:${Xt(e[t])}`).join(",")}}`}catch{return String(e)}},mg=e=>typeof e=="string"?JSON.stringify(e):String(e),Sl=e=>Array.isArray(e),gg=e=>!Array.isArray(e),Ac=e=>`[${mg(e)}]`,pg=e=>Sl(e)?e.map(Ac).join(""):Ac(e),Is=(e,t,n,r)=>{let s=e;return t!==void 0&&(s+=`
details: ${t}`),s},Cc=e=>Is("Duplicate index signature",`${e} index signature`),yg=Is("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),_g=Is("Invalid element","A required element cannot follow an optional element. ts(1257)"),bg=e=>Is("Duplicate property signature",`Duplicate key ${Xt(e)}`),Pc=Symbol.for("@effect/schema/annotation/Type"),wl=Symbol.for("@effect/schema/annotation/Message"),kl=Symbol.for("@effect/schema/annotation/MissingMessage"),vl=Symbol.for("@effect/schema/annotation/Identifier"),pn=Symbol.for("@effect/schema/annotation/Title"),Si=Symbol.for("@effect/schema/annotation/Description"),Sg=Symbol.for("@effect/schema/annotation/Examples"),wg=Symbol.for("@effect/schema/annotation/Default"),kg=Symbol.for("@effect/schema/annotation/JSONSchema"),vg=Symbol.for("@effect/schema/annotation/Documentation"),Ol=Symbol.for("@effect/schema/annotation/Concurrency"),El=Symbol.for("@effect/schema/annotation/Batching"),Il=Symbol.for("@effect/schema/annotation/ParseIssueTitle"),Tl=Symbol.for("@effect/schema/annotation/ParseOptions"),Fl=Symbol.for("@effect/schema/annotation/DecodingFallback"),Og=Symbol.for("@effect/schema/annotation/Surrogate"),Eg=Symbol.for("@effect/schema/annotation/StableFilter"),$e=h(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?E(e.annotations[t]):w()),Ig=$e(wl),Tg=$e(kl),Fg=$e(pn),$l=$e(vl),$g=$e(Si),Rg=$e(Ol),Mg=$e(El),Ng=$e(Il),Ag=$e(Tl),Cg=$e(Fl),Pg=$e(Og),xg=$e(Eg),Lg=e=>Vm(xg(e),t=>t===!0),Rl=Symbol.for("@effect/schema/annotation/JSONIdentifier"),jg=$e(Rl);class Ml{constructor(t,n,r,s={}){c(this,"typeParameters");c(this,"decodeUnknown");c(this,"encodeUnknown");c(this,"annotations");c(this,"_tag","Declaration");this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return he(Xe(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:be(this.annotations)}}}const nr=e=>t=>t._tag===e;class Kg{constructor(t,n={}){c(this,"literal");c(this,"annotations");c(this,"_tag","Literal");this.literal=t,this.annotations=n}toString(){return he(Xe(this),()=>Xt(this.literal))}toJSON(){return{_tag:this._tag,literal:Ss(this.literal)?String(this.literal):this.literal,annotations:be(this.annotations)}}}const xc=nr("Literal");class qg{constructor(t,n={}){c(this,"symbol");c(this,"annotations");c(this,"_tag","UniqueSymbol");this.symbol=t,this.annotations=n}toString(){return he(Xe(this),()=>Xt(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:be(this.annotations)}}}class Dg{constructor(t={}){c(this,"annotations");c(this,"_tag","NeverKeyword");this.annotations=t}toString(){return Ts(this)}toJSON(){return{_tag:this._tag,annotations:be(this.annotations)}}}const Ug=new Dg({[pn]:"never"});class Bg{constructor(t={}){c(this,"annotations");c(this,"_tag","UnknownKeyword");this.annotations=t}toString(){return Ts(this)}toJSON(){return{_tag:this._tag,annotations:be(this.annotations)}}}const Jg=new Bg({[pn]:"unknown"});class Vg{constructor(t={}){c(this,"annotations");c(this,"_tag","AnyKeyword");this.annotations=t}toString(){return Ts(this)}toJSON(){return{_tag:this._tag,annotations:be(this.annotations)}}}const Hg=new Vg({[pn]:"any"});class Gg{constructor(t={}){c(this,"annotations");c(this,"_tag","StringKeyword");this.annotations=t}toString(){return Ts(this)}toJSON(){return{_tag:this._tag,annotations:be(this.annotations)}}}const Wg=new Gg({[pn]:"string",[Si]:"a string"}),Nl=nr("StringKeyword"),zg=nr("NumberKeyword"),Yg=nr("SymbolKeyword");let wi=class{constructor(t,n={}){c(this,"type");c(this,"annotations");this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:be(this.annotations)}}toString(){return String(this.type)}};class ki extends wi{constructor(n,r,s={}){super(n,s);c(this,"isOptional");this.isOptional=r}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:be(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const Al=e=>e.map(t=>t.type);class Cl{constructor(t,n,r,s={}){c(this,"elements");c(this,"rest");c(this,"isReadonly");c(this,"annotations");c(this,"_tag","TupleType");this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,i=!1;for(const a of t)if(a.isOptional)o=!0;else if(o){i=!0;break}if(i||o&&n.length>1)throw new Error(_g)}toString(){return he(Xe(this),()=>Qg(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:be(this.annotations)}}}const Qg=e=>{const t=e.elements.map(String).join(", ");return zm(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const i=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${i}]`:`readonly [...${o}[], ${i}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class Qr extends ki{constructor(n,r,s,o,i){super(r,s,i);c(this,"name");c(this,"isReadonly");this.name=n,this.isReadonly=o}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:be(this.annotations)}}}const Pl=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return Pl(e.from)}return!1};class xl{constructor(t,n,r){c(this,"type");c(this,"isReadonly");c(this,"parameter");if(this.type=n,this.isReadonly=r,Pl(t))this.parameter=t;else throw new Error(yg)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class Xr{constructor(t,n,r={}){c(this,"annotations");c(this,"_tag","TypeLiteral");c(this,"propertySignatures");c(this,"indexSignatures");this.annotations=r;const s={};for(let i=0;i<t.length;i++){const a=t[i].name;if(Object.prototype.hasOwnProperty.call(s,a))throw new Error(bg(a));s[a]=null}const o={string:!1,symbol:!1};for(let i=0;i<n.length;i++){const a=Dl(n[i].parameter);if(Nl(a)){if(o.string)throw new Error(Cc("string"));o.string=!0}else if(Yg(a)){if(o.symbol)throw new Error(Cc("symbol"));o.symbol=!0}}this.propertySignatures=t,this.indexSignatures=n}toString(){return he(Xe(this),()=>Xg(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:be(this.annotations)}}}const Lc=e=>e.map(String).join("; "),Xg=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${Lc(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${Lc(e.indexSignatures)} }`:"{}"},Zg=jn(ll(Qt,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),ep={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},Ll=e=>gl(e,t=>rp(t)?Ll(t.types):[t]),tp=e=>{const t=Zg(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[Hg];case"UnknownKeyword":return[Jg];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const i=typeof o.literal;switch(i){case"string":case"number":case"bigint":case"boolean":{const a=ep[i];!r[a]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n},Ut=class Ut{constructor(t,n={}){c(this,"types");c(this,"annotations");c(this,"_tag","Union");this.types=t,this.annotations=n}toString(){return he(Xe(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:be(this.annotations)}}};c(Ut,"make",(t,n)=>np(t)?new Ut(t,n):t.length===1?t[0]:Ug),c(Ut,"unify",(t,n)=>Ut.make(tp(Ll(t)),n));let vt=Ut;const np=e=>e.length>1,rp=nr("Union"),no=j(Symbol.for("@effect/schema/AST/toJSONMemoMap"),()=>new WeakMap);class jl{constructor(t,n={}){c(this,"f");c(this,"annotations");c(this,"_tag","Suspend");this.f=t,this.annotations=n,this.f=bl(t)}toString(){return Xe(this).pipe(zr(()=>tr(Lm(this.f)(),t=>Xe(t))),he(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=no.get(t);return n||(no.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:be(this.annotations)},no.set(t,n),n)}}let Kl=class{constructor(t,n,r={}){c(this,"from");c(this,"filter");c(this,"annotations");c(this,"_tag","Refinement");this.from=t,this.filter=n,this.annotations=r}toString(){return he(Xe(this),()=>`{ ${this.from} | filter }`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:be(this.annotations)}}};const ro={},ql=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e);return n.annotations.value={...e.annotations,...t},Object.create(Object.getPrototypeOf(e),n)},sp=".*",op="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",ip=e=>{let t=`^${To(e.head)}`;for(const n of e.spans)Nl(n.type)?t+=sp:zg(n.type)&&(t+=op),t+=To(n.literal);return t+="$",new RegExp(t)},We=e=>{switch(e._tag){case"Declaration":{const t=Ce(e.typeParameters,We);return t===e.typeParameters?e:new Ml(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=Ce(e.elements,s=>{const o=We(s.type);return o===s.type?s:new ki(o,s.isOptional)}),n=Al(e.rest),r=Ce(n,We);return t===e.elements&&r===n?e:new Cl(t,r.map(s=>new wi(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=Ce(e.propertySignatures,r=>{const s=We(r.type);return s===r.type?r:new Qr(r.name,s,r.isOptional,r.isReadonly)}),n=Ce(e.indexSignatures,r=>{const s=We(r.type);return s===r.type?r:new xl(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new Xr(t,n,e.annotations)}case"Union":{const t=Ce(e.types,We);return t===e.types?e:vt.make(t,e.annotations)}case"Suspend":return new jl(()=>We(e.f()),e.annotations);case"Refinement":{const t=We(e.from);return t===e.from?e:new Kl(t,e.filter,e.annotations)}case"Transformation":return We(e.to)}return e},cp=e=>zr(jg(e),()=>$l(e)),wr=e=>Qe(cp(e),{onNone:()=>{},onSome:t=>({[Rl]:t})});function Ce(e,t){let n=!1;const r=Es(e.length);for(let s=0;s<e.length;s++){const o=e[s],i=t(o);i!==o&&(n=!0),r[s]=i}return n?r:e}const ze=(e,t)=>{switch(e._tag){case"Declaration":{const n=Ce(e.typeParameters,r=>ze(r));return n===e.typeParameters?e:new Ml(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=Ce(e.elements,o=>{const i=ze(o.type);return i===o.type?o:new ki(i,o.isOptional)}),r=Al(e.rest),s=Ce(r,o=>ze(o));return n===e.elements&&s===r?e:new Cl(n,s.map(o=>new wi(o)),e.isReadonly,wr(e))}case"TypeLiteral":{const n=Ce(e.propertySignatures,s=>{const o=ze(s.type);return o===s.type?s:new Qr(s.name,o,s.isOptional,s.isReadonly)}),r=Ce(e.indexSignatures,s=>{const o=ze(s.type);return o===s.type?s:new xl(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new Xr(n,r,wr(e))}case"Union":{const n=Ce(e.types,r=>ze(r));return n===e.types?e:vt.make(n,wr(e))}case"Suspend":return new jl(()=>ze(e.f()),wr(e));case"Refinement":return ze(e.from);case"Transformation":return ze(e.from)}return e},jc=e=>ze(e),be=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},Dl=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return Dl(e.from)}},Ts=e=>he(Xe(e),()=>e._tag),Xe=e=>$l(e).pipe(zr(()=>Fg(e)),zr(()=>$g(e))),ap=Symbol.for("@effect/schema/TypeId/MinLength"),up=Symbol.for("@effect/schema/ArbitraryHookId"),Ul=Symbol.for("effect/Chunk");function lp(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const Bl=[],fp=e=>fi((t,n)=>t.length===n.length&&Ot(t).every((r,s)=>e(r,Jt(n,s)))),hp=fp(M),dp={[Ul]:{_A:e=>e},toString(){return ue(this.toJSON())},toJSON(){return{_id:"Chunk",values:Ot(this).map(se)}},[G](){return this.toJSON()},[R](e){return Jl(e)&&hp(this,e)},[N](){return W(this,Qn(Ot(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return Bl[Symbol.iterator]();default:return Ot(this)[Symbol.iterator]()}},pipe(){return F(this,arguments)}},ee=e=>{const t=Object.create(dp);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=Ye,t.right=Ye;break}case"ISingleton":{t.length=1,t.depth=0,t.left=Ye,t.right=Ye;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=Ye,t.right=Ye;break}}return t},Jl=e=>A(e,Ul),Ye=ee({_tag:"IEmpty"}),ct=()=>Ye,so=(...e)=>pp(e),Te=e=>ee({_tag:"ISingleton",a:e}),Vl=e=>Jl(e)?e:Fs(Q(e)),Fo=(e,t,n)=>{switch(e.backing._tag){case"IArray":{lp(e.backing.array,0,t,n,e.length);break}case"IConcat":{Fo(e.left,t,n),Fo(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=Jt(e,r),r+=1,s+=1;break}}},mp=e=>{switch(e.backing._tag){case"IEmpty":return Bl;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return Fo(e,t,0),e.backing={_tag:"IArray",array:t},e.left=Ye,e.right=Ye,e.depth=0,t}}},Ot=mp,gp=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return ee({_tag:"IArray",array:Rc(e.backing.array)});case"IConcat":return ee({_tag:"IConcat",left:Zt(e.backing.right),right:Zt(e.backing.left)});case"ISlice":return Fs(Rc(Ot(e)))}},Zt=gp,Fs=e=>e.length===0?ct():e.length===1?Te(e[0]):ee({_tag:"IArray",array:e}),pp=e=>Fs(e),Jt=h(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?Jt(e.left,t):Jt(e.right,t-e.left.length);case"ISlice":return Jt(e.backing.chunk,t+e.backing.offset)}}),yp=h(2,(e,t)=>Ue(e,Te(t))),He=h(2,(e,t)=>Ue(Te(t),e)),$o=h(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return Ye;switch(e.backing._tag){case"ISlice":return ee({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?$o(e.right,t-e.left.length):ee({_tag:"IConcat",left:$o(e.left,t),right:e.right});default:return ee({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),Ue=h(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return ee({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=Ue(e.right,t);return ee({_tag:"IConcat",left:e.left,right:r})}else{const r=Ue(e.right.right,t);if(r.depth===e.depth-3){const s=ee({_tag:"IConcat",left:e.right.left,right:r});return ee({_tag:"IConcat",left:e.left,right:s})}else{const s=ee({_tag:"IConcat",left:e.left,right:e.right.left});return ee({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=Ue(e,t.left);return ee({_tag:"IConcat",left:r,right:t.right})}else{const r=Ue(e,t.left.left);if(r.depth===t.depth-3){const s=ee({_tag:"IConcat",left:r,right:t.left.right});return ee({_tag:"IConcat",left:s,right:t.right})}else{const s=ee({_tag:"IConcat",left:t.left.right,right:t.right});return ee({_tag:"IConcat",left:r,right:s})}}}),_p=e=>e.length===0,en=e=>e.length>0,Hl=e=>Jt(e,0),tn=Hl,bt=e=>$o(e,1),Ft=5,vi=Math.pow(2,Ft),bp=vi-1,Sp=vi/2,wp=vi/4;function kp(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function nn(e,t){return t>>>e&bp}function Dt(e){return 1<<e}function Gl(e,t){return kp(e&t-1)}const vp=(e,t)=>({value:e,previous:t});function Vt(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let i=0;i<o;++i)s[i]=r[i]}return s[t]=n,s}function Wl(e,t,n){const r=n.length-1;let s=0,o=0,i=n;if(e)s=o=t;else for(i=new Array(r);s<t;)i[o++]=n[s++];for(++s;s<=r;)i[o++]=n[s++];return e&&(i.length=r),i}function Op(e,t,n,r){const s=r.length;if(e){let u=s;for(;u>=t;)r[u--]=r[u];return r[t]=n,r}let o=0,i=0;const a=new Array(s+1);for(;o<t;)a[i++]=r[o++];for(a[t]=n;o<s;)a[++i]=r[o++];return a}class mt{constructor(){c(this,"_tag","EmptyNode")}modify(t,n,r,s,o,i){const a=r(w());return oe(a)?new mt:(++i.value,new Et(t,s,o,a))}}function Be(e){return Uu(e,"EmptyNode")}function Ep(e){return Be(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function $s(e,t){return Be(e)?!1:t===e.edit}class Et{constructor(t,n,r,s){c(this,"edit");c(this,"hash");c(this,"key");c(this,"value");c(this,"_tag","LeafNode");this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,i){if(M(o,this.key)){const u=r(this.value);return u===this.value?this:oe(u)?(--i.value,new mt):$s(this,t)?(this.value=u,this):new Et(t,s,o,u)}const a=r(w());return oe(a)?this:(++i.value,zl(t,n,this.hash,this,s,new Et(t,s,o,a)))}}class Oi{constructor(t,n,r){c(this,"edit");c(this,"hash");c(this,"children");c(this,"_tag","CollisionNode");this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,i){if(s===this.hash){const u=$s(this,t),l=this.updateCollisionList(u,t,this.hash,this.children,r,o,i);return l===this.children?this:l.length>1?new Oi(t,this.hash,l):l[0]}const a=r(w());return oe(a)?this:(++i.value,zl(t,n,this.hash,this,s,new Et(t,s,o,a)))}updateCollisionList(t,n,r,s,o,i,a){const u=s.length;for(let f=0;f<u;++f){const d=s[f];if("key"in d&&M(i,d.key)){const p=d.value,g=o(p);return g===p?s:oe(g)?(--a.value,Wl(t,f,s)):Vt(t,f,new Et(n,r,i,g),s)}}const l=o(w());return oe(l)?s:(++a.value,Vt(t,u,new Et(n,r,i,l),s))}}class rn{constructor(t,n,r){c(this,"edit");c(this,"mask");c(this,"children");c(this,"_tag","IndexedNode");this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,i){const a=this.mask,u=this.children,l=nn(n,s),f=Dt(l),d=Gl(a,f),p=a&f,g=$s(this,t);if(!p){const K=new mt().modify(t,n+Ft,r,s,o,i);return K?u.length>=Sp?Tp(t,l,K,a,u):new rn(t,a|f,Op(g,d,K,u)):this}const y=u[d],b=y.modify(t,n+Ft,r,s,o,i);if(y===b)return this;let _=a,v;if(Be(b)){if(_&=~f,!_)return new mt;if(u.length<=2&&Ep(u[d^1]))return u[d^1];v=Wl(g,d,u)}else v=Vt(g,d,b,u);return g?(this.mask=_,this.children=v,this):new rn(t,_,v)}}class Ei{constructor(t,n,r){c(this,"edit");c(this,"size");c(this,"children");c(this,"_tag","ArrayNode");this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,i){let a=this.size;const u=this.children,l=nn(n,s),f=u[l],d=(f||new mt).modify(t,n+Ft,r,s,o,i);if(f===d)return this;const p=$s(this,t);let g;if(Be(f)&&!Be(d))++a,g=Vt(p,l,d,u);else if(!Be(f)&&Be(d)){if(--a,a<=wp)return Ip(t,a,l,u);g=Vt(p,l,new mt,u)}else g=Vt(p,l,d,u);return p?(this.size=a,this.children=g,this):new Ei(t,a,g)}}function Ip(e,t,n,r){const s=new Array(t-1);let o=0,i=0;for(let a=0,u=r.length;a<u;++a)if(a!==n){const l=r[a];l&&!Be(l)&&(s[o++]=l,i|=1<<a)}return new rn(e,i,s)}function Tp(e,t,n,r,s){const o=[];let i=r,a=0;for(let u=0;i;++u)i&1&&(o[u]=s[a++]),i>>>=1;return o[t]=n,new Ei(e,a+1,o)}function Fp(e,t,n,r,s,o){if(n===s)return new Oi(e,n,[o,r]);const i=nn(t,n),a=nn(t,s);if(i===a)return u=>new rn(e,Dt(i)|Dt(a),[u]);{const u=i<a?[r,o]:[o,r];return new rn(e,Dt(i)|Dt(a),u)}}function zl(e,t,n,r,s,o){let i,a=t;for(;;){const u=Fp(e,a,n,r,s,o);if(typeof u=="function")i=vp(u,i),a=a+Ft;else{let l=u;for(;i!=null;)l=i.value(l),i=i.previous;return l}}}const Yl="effect/HashMap",Ro=Symbol.for(Yl),$p={[Ro]:Ro,[Symbol.iterator](){return new Rs(this,(e,t)=>[e,t])},[N](){let e=S(Yl);for(const t of this)e^=m(S(t[0]),q(S(t[1])));return W(this,e)},[R](e){if(Np(e)){if(e._size!==this._size)return!1;for(const t of this){const n=m(e,Ti(t[0],S(t[0])));if(oe(n))return!1;if(!M(t[1],n.value))return!1}return!0}return!1},toString(){return ue(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(se)}},[G](){return this.toJSON()},pipe(){return F(this,arguments)}},Ii=(e,t,n,r)=>{const s=Object.create($p);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class Rs{constructor(t,n){c(this,"map");c(this,"f");c(this,"v");this.map=t,this.f=n,this.v=Ql(this.map._root,this.f,void 0)}next(){if(oe(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=Zr(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new Rs(this.map,this.f)}}const Zr=e=>e?Xl(e[0],e[1],e[2],e[3],e[4]):w(),Ql=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return me(e.value)?E({value:t(e.key,e.value.value),cont:n}):Zr(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return Xl(r.length,r,0,t,n)}default:return Zr(n)}},Xl=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!Be(o))return Ql(o,r,[e,t,n,r,s])}return Zr(s)},Rp=Ii(!1,0,new mt,0),Ms=()=>Rp,Mp=e=>{const t=ef(Ms());for(const n of e)Kn(t,n[0],n[1]);return Lp(t)},Np=e=>A(e,Ro),Ap=e=>e&&Be(e._root),Cp=h(2,(e,t)=>Ti(e,t,S(t))),Ti=h(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return M(t,r.key)?r.value:w();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let i=0,a=o.length;i<a;++i){const u=o[i];if("key"in u&&M(t,u.key))return u.value}}return w()}case"IndexedNode":{const o=nn(s,n),i=Dt(o);if(r.mask&i){r=r.children[Gl(r.mask,i)],s+=Ft;break}return w()}case"ArrayNode":{if(r=r.children[nn(s,n)],r){s+=Ft;break}return w()}default:return w()}}),Pp=h(2,(e,t)=>me(Ti(e,t,S(t)))),Kn=h(3,(e,t,n)=>Fi(e,t,()=>E(n))),xp=h(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:Ii(e._editable,e._edit,t,n)),Zl=e=>new Rs(e,t=>t),Mo=e=>e._size,ef=e=>Ii(!0,e._edit+1,e._root,e._size),Lp=e=>(e._editable=!1,e),Fi=h(3,(e,t,n)=>jp(e,t,S(t),n)),jp=h(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return m(e,xp(o,s.value))}),Kc=h(2,(e,t)=>Fi(e,t,w)),Kp=h(2,(e,t)=>Ns(e,Ms(),(n,r,s)=>Kn(n,s,t(r,s)))),qp=h(2,(e,t)=>Ns(e,void 0,(n,r,s)=>t(r,s))),Ns=h(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return me(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let i=0,a=o.length;i<a;){const u=o[i++];u&&!Be(u)&&(u._tag==="LeafNode"?me(u.value)&&(t=n(t,u.value.value,u.key)):s.push(u.children))}return t}),tf="effect/HashSet",No=Symbol.for(tf),Dp={[No]:No,[Symbol.iterator](){return Zl(this._keyMap)},[N](){return W(this,q(S(this._keyMap))(S(tf)))},[R](e){return Up(e)?Mo(this._keyMap)===Mo(e._keyMap)&&M(this._keyMap,e._keyMap):!1},toString(){return ue(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(se)}},[G](){return this.toJSON()},pipe(){return F(this,arguments)}},As=e=>{const t=Object.create(Dp);return t._keyMap=e,t},Up=e=>A(e,No),Bp=As(Ms()),Cs=()=>Bp,Jp=e=>{const t=$i(Cs());for(const n of e)qn(t,n);return Ri(t)},Vp=(...e)=>{const t=$i(Cs());for(const n of e)qn(t,n);return Ri(t)},Hp=h(2,(e,t)=>Pp(e._keyMap,t)),Gp=e=>Mo(e._keyMap),$i=e=>As(ef(e._keyMap)),Ri=e=>(e._keyMap._editable=!1,e),nf=h(2,(e,t)=>{const n=$i(e);return t(n),Ri(n)}),qn=h(2,(e,t)=>e._keyMap._editable?(Kn(t,!0)(e._keyMap),e):As(Kn(t,!0)(e._keyMap))),rf=h(2,(e,t)=>e._keyMap._editable?(Kc(t)(e._keyMap),e):As(Kc(t)(e._keyMap))),Wp=h(2,(e,t)=>nf(e,n=>{for(const r of t)rf(n,r)})),zp=h(2,(e,t)=>nf(Cs(),n=>{Yp(e,r=>qn(n,r));for(const r of t)qn(n,r)})),Yp=h(2,(e,t)=>qp(e._keyMap,(n,r)=>t(r))),Qp=h(3,(e,t,n)=>Ns(e._keyMap,t,(r,s,o)=>n(r,o))),$t=Cs,Xp=Jp,Mi=Vp,Zp=Hp,sf=Gp,xn=qn,of=rf,qc=Wp,Dn=zp,es=Qp,rr="Die",Rt="Empty",yn="Fail",_n="Interrupt",sn="Parallel",on="Sequential",cf="effect/Cause",af=Symbol.for(cf),ey={_E:e=>e},bn={[af]:ey,[N](){return m(S(cf),q(S(dy(this))),W(this))},[R](e){return ty(e)&&hy(this,e)},pipe(){return F(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:se(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:se(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:se(this.left),right:se(this.right)}}},toString(){return or(this)},[G](){return this.toJSON()}},cn=(()=>{const e=Object.create(bn);return e._tag=Rt,e})(),ts=e=>{const t=Object.create(bn);return t._tag=yn,t.error=e,t},Pe=e=>{const t=Object.create(bn);return t._tag=rr,t.defect=e,t},ft=e=>{const t=Object.create(bn);return t._tag=_n,t.fiberId=e,t},sr=(e,t)=>{const n=Object.create(bn);return n._tag=sn,n.left=e,n.right=t,n},Ie=(e,t)=>{const n=Object.create(bn);return n._tag=on,n.left=e,n.right=t,n},ty=e=>A(e,af),ny=e=>e._tag===Rt,ry=e=>e._tag===Rt?!0:an(e,!0,(t,n)=>{switch(n._tag){case Rt:return E(t);case rr:case yn:case _n:return E(!1);default:return w()}}),sy=e=>me(uy(e)),Ni=e=>Ci(void 0,gy)(e),oy=e=>Zt(an(e,ct(),(t,n)=>n._tag===yn?E(m(t,He(n.error))):w())),uf=e=>Zt(an(e,ct(),(t,n)=>n._tag===rr?E(m(t,He(n.defect))):w())),iy=e=>an(e,$t(),(t,n)=>n._tag===_n?E(m(t,xn(n.fiberId))):w()),cy=e=>lf(e,t=>t._tag===yn?E(t.error):w()),ay=e=>{const t=cy(e);switch(t._tag){case"None":return re(e);case"Some":return L(t.value)}},uy=e=>lf(e,t=>t._tag===_n?E(t.fiberId):w()),ly=e=>Ai(e,{onEmpty:w(),onFail:t=>E(Pe(t)),onDie:t=>E(Pe(t)),onInterrupt:()=>w(),onSequential:$c(Ie),onParallel:$c(sr)}),Dc=e=>Ai(e,{onEmpty:cn,onFail:()=>cn,onDie:Pe,onInterrupt:ft,onSequential:Ie,onParallel:sr}),fy=e=>Ai(e,{onEmpty:cn,onFail:Pe,onDie:Pe,onInterrupt:ft,onSequential:Ie,onParallel:sr}),hy=(e,t)=>{let n=Te(e),r=Te(t);for(;en(n)&&en(r);){const[s,o]=m(tn(n),an([$t(),ct()],([u,l],f)=>{const[d,p]=Ao(f);return E([m(u,Dn(d)),m(l,Ue(p))])})),[i,a]=m(tn(r),an([$t(),ct()],([u,l],f)=>{const[d,p]=Ao(f);return E([m(u,Dn(d)),m(l,Ue(p))])}));if(!M(s,i))return!1;n=o,r=a}return!0},dy=e=>my(Te(e),ct()),my=(e,t)=>{for(;;){const[n,r]=m(e,pl([$t(),ct()],([o,i],a)=>{const[u,l]=Ao(a);return[m(o,Dn(u)),m(i,Ue(l))]})),s=sf(n)>0?m(t,He(n)):t;if(_p(r))return Zt(s);e=r,t=s}throw new Error(ws("Cause.flattenCauseLoop"))},lf=h(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case on:case sn:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return w()}),Ao=e=>{let t=e;const n=[];let r=$t(),s=ct();for(;t!==void 0;)switch(t._tag){case Rt:{if(n.length===0)return[r,s];t=n.pop();break}case yn:{if(r=xn(r,so(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case rr:{if(r=xn(r,so(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case _n:{if(r=xn(r,so(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case on:{switch(t.left._tag){case Rt:{t=t.right;break}case on:{t=Ie(t.left.left,Ie(t.left.right,t.right));break}case sn:{t=sr(Ie(t.left.left,t.right),Ie(t.left.right,t.right));break}default:{s=He(s,t.right),t=t.left;break}}break}case sn:{n.push(t.right),t=t.left;break}}throw new Error(ws("Cause.evaluateCauseLoop"))},gy={emptyCase:Tc,failCase:ko,dieCase:ko,interruptCase:Tc,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},Uc="SequentialCase",Bc="ParallelCase",Ai=h(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:i})=>Ci(e,void 0,{emptyCase:()=>n,failCase:(a,u)=>r(u),dieCase:(a,u)=>t(u),interruptCase:(a,u)=>s(u),sequentialCase:(a,u,l)=>i(u,l),parallelCase:(a,u,l)=>o(u,l)})),an=h(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const i=n(r,s);switch(r=me(i)?i.value:r,s._tag){case on:{o.push(s.right),s=s.left;break}case sn:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),Ci=h(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const i=r.pop();switch(i._tag){case Rt:{s.push(re(n.emptyCase(t)));break}case yn:{s.push(re(n.failCase(t,i.error)));break}case rr:{s.push(re(n.dieCase(t,i.defect)));break}case _n:{s.push(re(n.interruptCase(t,i.fiberId)));break}case on:{r.push(i.right),r.push(i.left),s.push(L({_tag:Uc}));break}case sn:{r.push(i.right),r.push(i.left),s.push(L({_tag:Bc}));break}}}const o=[];for(;s.length>0;){const i=s.pop();switch(i._tag){case"Left":{switch(i.left._tag){case Uc:{const a=o.pop(),u=o.pop(),l=n.sequentialCase(t,a,u);o.push(l);break}case Bc:{const a=o.pop(),u=o.pop(),l=n.parallelCase(t,a,u);o.push(l);break}}break}case"Right":{o.push(i.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),or=(e,t)=>Ni(e)?"All fibers interrupted without errors.":hf(e).map(function(n){return(t==null?void 0:t.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${ff(n.cause,"  ")}
}`}).join(`
`),ff=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${ff(e.cause,`${t}  `)}
${t}}`),r};class ns extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(py(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new ns(n.cause)}:void 0);c(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(un in n&&(this.span=n[un]),Object.keys(n).forEach(o=>{o in this||(this[o]=n[o])})),this.stack=by(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const py=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(A(e,"toString")&&Wn(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return Gu(e)},yy=/\((.*)\)/g,_y=j("effect/Tracer/spanToTrace",()=>new WeakMap),by=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length;o++){if(s[o].includes(" at new BaseEffectError")||s[o].includes(" at new YieldableError")){o++;continue}if(s[o].includes("Generator.next")||s[o].includes("effect_internal_function"))break;r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,i=0;for(;o&&o._tag==="Span"&&i<10;){const a=_y.get(o);if(typeof a=="function"){const u=a();if(typeof u=="string"){const l=u.matchAll(yy);let f=!1;for(const[,d]of l)f=!0,r.push(`    at ${o.name} (${d})`);f||r.push(`    at ${o.name} (${u.replace(/^at /,"")})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=rt(o.parent),i++}}return r.join(`
`)},un=Symbol.for("effect/SpanAnnotation"),hf=e=>Ci(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new ns(n)],failCase:(t,n)=>[new ns(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),Sy=Symbol.for("effect/Context/Tag"),rs=Symbol.for("effect/Context/Reference"),wy="effect/STM",ky=Symbol.for(wy),df={...Zn,_op:"Tag",[ky]:zt,[Sy]:{_Service:e=>e,_Identifier:e=>e},toString(){return ue(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[G](){return this.toJSON()},of(e){return e},context(e){return gf(this,e)}},vy={...df,[rs]:rs},Oy=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(df);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},Ey=()=>(e,t)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,vy),s.key=e,s.defaultValue=t.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},mf=Symbol.for("effect/Context"),Iy={[mf]:{_Services:e=>e},[R](e){if(Fy(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!M(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[N](){return W(this,di(this.unsafeMap.size))},pipe(){return F(this,arguments)},toString(){return ue(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(se)}},[G](){return this.toJSON()}},ln=e=>{const t=Object.create(Iy);return t.unsafeMap=e,t},Ty=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},Fy=e=>A(e,mf),$y=e=>A(e,rs),Ry=ln(new Map),My=()=>Ry,gf=(e,t)=>ln(new Map([[e.key,t]])),Ny=h(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),ln(r)}),oo=j("effect/Context/defaultValueCache",()=>new Map),Pi=e=>{if(oo.has(e.key))return oo.get(e.key);const t=e.defaultValue();return oo.set(e.key,t),t},Ay=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):Pi(t),pf=h(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(rs in t)return Pi(t);throw Ty(t)}return e.unsafeMap.get(t.key)}),Cy=pf,Py=h(2,(e,t)=>e.unsafeMap.has(t.key)?Eo(e.unsafeMap.get(t.key)):$y(t)?Eo(Pi(t)):nl),xy=h(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return ln(n)}),Pt=Oy,xi=My,Ly=gf,In=Ny,yf=Cy,_f=pf,ir=Py,bf=xy,Sf=Ey,Co=Symbol.for("effect/Duration"),wf=BigInt(0),Jc=BigInt(24),kr=BigInt(60),Po=BigInt(1e3),Vc=BigInt(1e6),Hc=BigInt(1e9),jy=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,at=e=>{if(kf(e))return e;if(Gt(e))return xo(e);if(Ss(e))return io(e);if(Array.isArray(e)&&e.length===2&&e.every(Gt))return e[0]===-1/0||e[1]===-1/0||Number.isNaN(e[0])||Number.isNaN(e[1])?vf:e[0]===1/0||e[1]===1/0?Uy:io(BigInt(Math.round(e[0]*1e9))+BigInt(Math.round(e[1])));if(it(e)){const t=jy.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return io(BigInt(r));case"micro":case"micros":return By(BigInt(r));case"milli":case"millis":return xo(o);case"second":case"seconds":return Jy(o);case"minute":case"minutes":return Vy(o);case"hour":case"hours":return Hy(o);case"day":case"days":return Gy(o);case"week":case"weeks":return Wy(o)}}}throw new Error("Invalid DurationInput")},Gc={_tag:"Millis",millis:0},Ky={_tag:"Infinity"},qy={[Co]:Co,[N](){return W(this,Hu(this.value))},[R](e){return kf(e)&&t_(this,e)},toString(){return`Duration(${r_(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:Yy(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[G](){return this.toJSON()},pipe(){return F(this,arguments)}},Ze=e=>{const t=Object.create(qy);return Gt(e)?isNaN(e)||e<=0?t.value=Gc:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=Ky:e<=wf?t.value=Gc:t.value={_tag:"Nanos",nanos:e},t},kf=e=>A(e,Co),Dy=e=>{switch(e.value._tag){case"Millis":return e.value.millis===0;case"Nanos":return e.value.nanos===wf;case"Infinity":return!1}},vf=Ze(0),Uy=Ze(1/0),io=e=>Ze(e),By=e=>Ze(e*Po),xo=e=>Ze(e),Jy=e=>Ze(e*1e3),Vy=e=>Ze(e*6e4),Hy=e=>Ze(e*36e5),Gy=e=>Ze(e*864e5),Wy=e=>Ze(e*6048e5),Lo=e=>Qy(e,{onMillis:t=>t,onNanos:t=>Number(t)/1e6}),zy=e=>{const t=at(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},Yy=e=>{const t=at(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/Hc),Number(t.value.nanos%Hc)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},Qy=h(2,(e,t)=>{const n=at(e);switch(n.value._tag){case"Nanos":return t.onNanos(n.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(n.value.millis)}}),Li=h(3,(e,t,n)=>{const r=at(e),s=at(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(Lo(r),Lo(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),i=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,i)}return n.onMillis(r.value.millis,s.value.millis)}),Xy=(e,t)=>Li(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),Zy=h(2,(e,t)=>Li(e,t,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),e_=h(2,(e,t)=>Li(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),t_=h(2,(e,t)=>Xy(at(e),at(t))),n_=e=>{const t=at(e);if(t.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=zy(t),r=n/Vc,s=r/Po,o=s/kr,i=o/kr,a=i/Jc;return{days:Number(a),hours:Number(i%Jc),minutes:Number(o%kr),seconds:Number(s%kr),millis:Number(r%Po),nanos:Number(n%Vc)}},r_=e=>{const t=at(e);if(t.value._tag==="Infinity")return"Infinity";if(Dy(t))return"0";const n=n_(t),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},Wc=Symbol.for("effect/MutableRef"),s_={[Wc]:Wc,toString(){return ue(this.toJSON())},toJSON(){return{_id:"MutableRef",current:se(this.current)}},[G](){return this.toJSON()},pipe(){return F(this,arguments)}},Of=e=>{const t=Object.create(s_);return t.current=e,t},Ps=e=>e.current,Ef=h(2,(e,t)=>(e.current=t,e)),ji="effect/FiberId",Un=Symbol.for(ji),ss="None",jo="Runtime",o_="Composite",i_=Y(`${ji}-${ss}`);var Wa;let c_=class{constructor(){c(this,Wa,Un);c(this,"_tag",ss);c(this,"id",-1);c(this,"startTimeMillis",-1)}[(Wa=Un,N)](){return i_}[R](t){return If(t)&&t._tag===ss}toString(){return ue(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[G](){return this.toJSON()}};var za;class a_{constructor(t,n){c(this,"id");c(this,"startTimeMillis");c(this,za,Un);c(this,"_tag",jo);this.id=t,this.startTimeMillis=n}[(za=Un,N)](){return W(this,Y(`${ji}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[R](t){return If(t)&&t._tag===jo&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return ue(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[G](){return this.toJSON()}}const u_=new c_,If=e=>A(e,Un),Ko=e=>{switch(e._tag){case ss:return $t();case jo:return Mi(e.id);case o_:return m(Ko(e.left),Dn(Ko(e.right)))}},zc=j(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Of(0)),Tf=e=>Array.from(Ko(e)).map(n=>`#${n}`).join(","),l_=()=>{const e=Ps(zc);return m(zc,Ef(e+1)),new a_(e,Date.now())},fn=u_,f_=Tf,Ff=l_,Ki=Ms,h_=Mp,d_=Ap,$f=Cp,Rf=Kn,Mf=Zl,m_=Fi,g_=Kp,Nf=Ns,Bn=Symbol.for("effect/List"),qo=e=>Q(e),p_=e=>Bd(bi(e),qo),y_=p_(M),__={[Bn]:Bn,_tag:"Cons",toString(){return ue(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:qo(this).map(se)}},[G](){return this.toJSON()},[R](e){return Cf(e)&&this._tag===e._tag&&y_(this,e)},[N](){return W(this,Qn(qo(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return F(this,arguments)}},os=(e,t)=>{const n=Object.create(__);return n.head=e,n.tail=t,n},b_=Y("Nil"),S_={[Bn]:Bn,_tag:"Nil",toString(){return ue(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[G](){return this.toJSON()},[N](){return b_},[R](e){return Cf(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return F(this,arguments)}},Af=Object.create(S_),Cf=e=>A(e,Bn),ot=e=>e._tag==="Nil",w_=e=>e._tag==="Cons",k_=()=>Af,Mt=(e,t)=>os(e,t),hn=k_,qi=e=>os(e,Af),v_=h(2,(e,t)=>E_(t,e)),O_=h(2,(e,t)=>Mt(t,e)),E_=h(2,(e,t)=>{if(ot(e))return t;if(ot(t))return e;{const n=os(t.head,e);let r=n,s=t.tail;for(;!ot(s);){const o=os(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),I_=h(3,(e,t,n)=>{let r=t,s=e;for(;!ot(s);)r=n(r,s.head),s=s.tail;return r}),T_=e=>{let t=hn(),n=e;for(;!ot(n);)t=O_(t,n.head),n=n.tail;return t},Di=(function(){function e(t){t&&Object.assign(this,t)}return e.prototype=_i,e})(),F_=Symbol.for("effect/DifferContextPatch");function Yc(e){return e}const cr={...Di.prototype,[F_]:{_Value:Yc,_Patch:Yc}},$_=Object.assign(Object.create(cr),{_tag:"Empty"}),R_=Object.create($_),Pf=()=>R_,M_=Object.assign(Object.create(cr),{_tag:"AndThen"}),N_=(e,t)=>{const n=Object.create(M_);return n.first=e,n.second=t,n},A_=Object.assign(Object.create(cr),{_tag:"AddService"}),C_=(e,t)=>{const n=Object.create(A_);return n.key=e,n.service=t,n},P_=Object.assign(Object.create(cr),{_tag:"RemoveService"}),x_=e=>{const t=Object.create(P_);return t.key=e,t},L_=Object.assign(Object.create(cr),{_tag:"UpdateService"}),j_=(e,t)=>{const n=Object.create(L_);return n.key=e,n.update=t,n},K_=(e,t)=>{const n=new Map(e.unsafeMap);let r=Pf();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const i=n.get(s);n.delete(s),M(i,o)||(r=xr(j_(s,()=>o))(r))}else n.delete(s),r=xr(C_(s,o))(r);for(const[s]of n.entries())r=xr(x_(s))(r);return r},xr=h(2,(e,t)=>N_(e,t)),q_=h(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=Te(e);const s=new Map(t.unsafeMap);for(;en(r);){const i=tn(r),a=bt(r);switch(i._tag){case"Empty":{r=a;break}case"AddService":{s.set(i.key,i.service),r=a;break}case"AndThen":{r=He(He(a,i.second),i.first);break}case"RemoveService":{s.delete(i.key),r=a;break}case"UpdateService":{s.set(i.key,i.update(s.get(i.key))),n=!0,r=a;break}}}if(!n)return ln(s);const o=new Map;for(const[i]of t.unsafeMap)s.has(i)&&(o.set(i,s.get(i)),s.delete(i));for(const[i,a]of s)o.set(i,a);return ln(o)}),D_=Symbol.for("effect/DifferHashSetPatch");function co(e){return e}const xs={...Di.prototype,[D_]:{_Value:co,_Key:co,_Patch:co}},U_=Object.assign(Object.create(xs),{_tag:"Empty"}),B_=Object.create(U_),xf=()=>B_,J_=Object.assign(Object.create(xs),{_tag:"AndThen"}),V_=(e,t)=>{const n=Object.create(J_);return n.first=e,n.second=t,n},H_=Object.assign(Object.create(xs),{_tag:"Add"}),G_=e=>{const t=Object.create(H_);return t.value=e,t},W_=Object.assign(Object.create(xs),{_tag:"Remove"}),z_=e=>{const t=Object.create(W_);return t.value=e,t},Y_=(e,t)=>{const[n,r]=es([e,xf()],([s,o],i)=>Zp(i)(s)?[of(i)(s),o]:[s,Do(G_(i))(o)])(t);return es(r,(s,o)=>Do(z_(o))(s))(n)},Do=h(2,(e,t)=>V_(e,t)),Q_=h(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=Te(e);for(;en(r);){const s=tn(r),o=bt(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=He(s.first)(He(s.second)(o));break}case"Add":{n=xn(s.value)(n),r=o;break}case"Remove":n=of(s.value)(n),r=o}}return n}),X_=Symbol.for("effect/DifferReadonlyArrayPatch");function Qc(e){return e}const ar={...Di.prototype,[X_]:{_Value:Qc,_Patch:Qc}},Z_=Object.assign(Object.create(ar),{_tag:"Empty"}),eb=Object.create(Z_),Lf=()=>eb,tb=Object.assign(Object.create(ar),{_tag:"AndThen"}),nb=(e,t)=>{const n=Object.create(tb);return n.first=e,n.second=t,n},rb=Object.assign(Object.create(ar),{_tag:"Append"}),sb=e=>{const t=Object.create(rb);return t.values=e,t},ob=Object.assign(Object.create(ar),{_tag:"Slice"}),ib=(e,t)=>{const n=Object.create(ob);return n.from=e,n.until=t,n},cb=Object.assign(Object.create(ar),{_tag:"Update"}),ab=(e,t)=>{const n=Object.create(cb);return n.index=e,n.patch=t,n},ub=e=>{let t=0,n=Lf();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);M(o,e.differ.empty)||(n=Lr(n,ab(t,o))),t=t+1}return t<e.oldValue.length&&(n=Lr(n,ib(0,t))),t<e.newValue.length&&(n=Lr(n,sb(sg(t)(e.newValue)))),n},Lr=h(2,(e,t)=>nb(e,t)),lb=h(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=qe(e);for(;Ar(s);){const o=_e(s),i=Tt(s);switch(o._tag){case"Empty":{s=i;break}case"AndThen":{i.unshift(o.first,o.second),s=i;break}case"Append":{for(const a of o.values)r.push(a);s=i;break}case"Slice":{r=r.slice(o.from,o.until),s=i;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=i;break}}}return r}),fb=Symbol.for("effect/Differ"),hb={[fb]:{_P:Z,_V:Z},pipe(){return F(this,arguments)}},Sn=e=>{const t=Object.create(hb);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},db=()=>Sn({empty:Pf(),combine:(e,t)=>xr(t)(e),diff:(e,t)=>K_(e,t),patch:(e,t)=>q_(t)(e)}),mb=()=>Sn({empty:xf(),combine:(e,t)=>Do(t)(e),diff:(e,t)=>Y_(e,t),patch:(e,t)=>Q_(t)(e)}),gb=e=>Sn({empty:Lf(),combine:(t,n)=>Lr(t,n),diff:(t,n)=>ub({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>lb(t,n,e)}),jf=()=>pb((e,t)=>t),pb=e=>Sn({empty:Z,combine:(t,n)=>t===Z?n:n===Z?t:r=>n(t(r)),diff:(t,n)=>M(t,n)?Z:_s(n),patch:(t,n)=>e(n,t(n))}),Jn=255,Kf=8,Uo=e=>e&Jn,Bo=e=>e>>Kf&Jn,ur=(e,t)=>(e&Jn)+((t&e&Jn)<<Kf),yb=ur(0,0),_b=e=>ur(e,e),bb=e=>ur(e,0),Sb=h(2,(e,t)=>ur(Uo(e)&~t,Bo(e))),wb=h(2,(e,t)=>e|t),kb=e=>~e>>>0&Jn,vb=0,wn=1,Ob=2,qf=4,Jo=16,Df=32,Eb=e=>Ls(e,Df),Ib=h(2,(e,t)=>e|t),lt=e=>Uf(e)&&!Fb(e),Uf=e=>Ls(e,wn),Ls=h(2,(e,t)=>(e&t)!==0),Bf=(...e)=>e.reduce((t,n)=>t|n,0),Tb=Bf(vb),Xc=e=>Ls(e,qf),Fb=e=>Ls(e,Jo),jr=h(2,(e,t)=>ur(e^t,t)),Kr=h(2,(e,t)=>e&(kb(Uo(t))|Bo(t))|Uo(t)&Bo(t)),Zc=Sn({empty:yb,diff:(e,t)=>jr(e,t),combine:(e,t)=>wb(t)(e),patch:(e,t)=>Kr(t,e)}),$b=_b,Jf=bb,ea=Sb,Vf=(e,t)=>({_tag:"Par",left:e,right:t}),vr=(e,t)=>({_tag:"Seq",left:e,right:t}),Rb=e=>{let t=qi(e),n=hn();for(;;){const[r,s]=I_(t,[Hf(),hn()],([o,i],a)=>{const[u,l]=Mb(a);return[xb(o,u),v_(i,l)]});if(n=Nb(n,r),ot(s))return T_(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},Mb=e=>{let t=e,n=Hf(),r=hn(),s=hn();for(;;)switch(t._tag){case"Empty":{if(ot(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=Mt(t.right,r),t=t.left;break}case"Seq":{const o=t.left,i=t.right;switch(o._tag){case"Empty":{t=i;break}case"Par":{const a=o.left,u=o.right;t=Vf(vr(a,i),vr(u,i));break}case"Seq":{const a=o.left,u=o.right;t=vr(a,vr(u,i));break}case"Single":{t=o,s=Mt(i,s);break}}break}case"Single":{if(n=Pb(n,t),ot(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},Nb=(e,t)=>{if(ot(e))return qi(ao(t));if(Lb(t))return e;const n=Bb(e.head),r=jb(t);return n.length===1&&r.length===1&&M(n[0],r[0])?Mt(Ub(e.head,ao(t)),e.tail):Mt(ao(t),e)},Ab=Symbol.for("effect/RequestBlock/RequestBlockParallel"),Cb={_R:e=>e};var Ya;Ya=Ab;class Ui{constructor(t){c(this,"map");c(this,Ya,Cb);this.map=t}}const Hf=()=>new Ui(Ki()),Pb=(e,t)=>new Ui(m_(e.map,t.dataSource,n=>xm(qm(n,yp(t.blockedRequest)),()=>Te(t.blockedRequest)))),xb=(e,t)=>new Ui(Nf(e.map,t.map,(n,r,s)=>Rf(n,s,Qe($f(n,s),{onNone:()=>r,onSome:o=>Ue(r,o)})))),Lb=e=>d_(e.map),jb=e=>Array.from(Mf(e.map)),ao=e=>Db(g_(e.map,t=>Te(t))),Kb=Symbol.for("effect/RequestBlock/RequestBlockSequential"),qb={_R:e=>e};var Qa;Qa=Kb;class Gf{constructor(t){c(this,"map");c(this,Qa,qb);this.map=t}}const Db=e=>new Gf(e),Ub=(e,t)=>new Gf(Nf(t.map,e.map,(n,r,s)=>Rf(n,s,Qe($f(n,s),{onNone:()=>ct(),onSome:o=>Ue(o,r)})))),Bb=e=>Array.from(Mf(e.map)),Jb=e=>Array.from(e.map),js="Pending",Wf="Done",Vb="effect/Deferred",Hb=Symbol.for(Vb),Gb={_E:e=>e,_A:e=>e},Wb=e=>({_tag:js,joiners:e}),zb=e=>({_tag:Wf,effect:e});class lr{constructor(t){c(this,"self");c(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new lr(this.self)}}const zf=(e,t)=>{const n=new de("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},Yb=e=>{const t=new de("RunBlocked");return t.effect_instruction_i0=e,t},dn=Symbol.for("effect/Effect");class Qb{constructor(t,n){c(this,"patch");c(this,"op");c(this,"_op",pi);this.patch=t,this.op=n}}var Xa;class de{constructor(t){c(this,"_op");c(this,"effect_instruction_i0");c(this,"effect_instruction_i1");c(this,"effect_instruction_i2");c(this,"trace");c(this,Xa,zt);this._op=t}[(Xa=dn,R)](t){return this===t}[N](){return W(this,hi(this))}pipe(){return F(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:se(this.effect_instruction_i0),effect_instruction_i1:se(this.effect_instruction_i1),effect_instruction_i2:se(this.effect_instruction_i2)}}toString(){return ue(this.toJSON())}[G](){return this.toJSON()}[Symbol.iterator](){return new lr(new Yn(this))}}var Za;class Yf{constructor(t){c(this,"_op");c(this,"effect_instruction_i0");c(this,"effect_instruction_i1");c(this,"effect_instruction_i2");c(this,"trace");c(this,Za,zt);this._op=t,this._tag=t}[(Za=dn,R)](t){return Ws(t)&&t._op==="Failure"&&M(this.effect_instruction_i0,t.effect_instruction_i0)}[N](){return m(Y(this._tag),q(S(this.effect_instruction_i0)),W(this))}get cause(){return this.effect_instruction_i0}pipe(){return F(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return ue(this.toJSON())}[G](){return this.toJSON()}[Symbol.iterator](){return new lr(new Yn(this))}}var eu;class Qf{constructor(t){c(this,"_op");c(this,"effect_instruction_i0");c(this,"effect_instruction_i1");c(this,"effect_instruction_i2");c(this,"trace");c(this,eu,zt);this._op=t,this._tag=t}[(eu=dn,R)](t){return Ws(t)&&t._op==="Success"&&M(this.effect_instruction_i0,t.effect_instruction_i0)}[N](){return m(Y(this._tag),q(S(this.effect_instruction_i0)),W(this))}get value(){return this.effect_instruction_i0}pipe(){return F(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:se(this.value)}}toString(){return ue(this.toJSON())}[G](){return this.toJSON()}[Symbol.iterator](){return new lr(new Yn(this))}}const Ks=e=>A(e,dn),Fe=e=>{const t=new de(Yu);return t.effect_instruction_i0=e,t},Xb=h(3,(e,t,n)=>Bs(r=>T(e,s=>T(Zf(te(()=>r(t(s)))),o=>te(()=>n(s,o)).pipe(Nt({onFailure:i=>{switch(o._tag){case Je:return xe(Ie(o.effect_instruction_i0,i));case Ve:return xe(i)}},onSuccess:()=>o})))))),fr=h(2,(e,t)=>T(e,()=>V(t))),hr=e=>fr(e,void 0),Xf=function(){const e=new de(vs);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(ws("you're not supposed to end up here"))}return e},is=(e,t=fn)=>{const n=new de(Cn);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,oh(n,s=>Ks(r)?r:Ge)},Zb=(e,t=fn)=>te(()=>is(e,t)),Vn=(e,t=fn)=>Xf(e,function(){let n,r;function s(u){n?n(u):r===void 0&&(r=u)}const o=new de(Cn);o.effect_instruction_i0=u=>{n=u,r&&u(r)},o.effect_instruction_i1=t;let i,a;return this.effect_instruction_i0.length!==1?(a=new AbortController,i=ye(()=>this.effect_instruction_i0(s,a.signal))):i=ye(()=>this.effect_instruction_i0(s)),i||a?oh(o,u=>(a&&a.abort(),i??Ge)):o}),Vo=h(2,(e,t)=>qs(e,{onFailure:t,onSuccess:V})),ta=Symbol.for("effect/OriginalAnnotation"),Bi=(e,t)=>me(t)?new Proxy(e,{has(n,r){return r===un||r===ta||r in n},get(n,r){return r===un?t.value:r===ta?e:n[r]}}):e,na=e=>zn(e)&&!(un in e)?Fe(t=>xe(Pe(Bi(e,Yi(t))))):xe(Pe(e)),eS=e=>tS(()=>Pe(new AS(e))),cs=e=>qs(e,{onFailure:t=>V(L(t)),onSuccess:t=>V(re(t))}),Zf=e=>sS(e,{onFailure:J,onSuccess:X}),Se=e=>zn(e)&&!(un in e)?Fe(t=>xe(ts(Bi(e,Yi(t))))):xe(ts(e)),eh=e=>T($(e),Se),xe=e=>{const t=new Yf(Je);return t.effect_instruction_i0=e,t},tS=e=>T($(e),xe),nS=Fe(e=>V(e.id())),th=e=>Fe(t=>e(t.id())),T=h(2,(e,t)=>{const n=new de(Hr);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),rS=e=>{const t=new de("OnStep");return t.effect_instruction_i0=e,t},nh=e=>T(e,Z),sS=h(2,(e,t)=>Nt(e,{onFailure:n=>V(t.onFailure(n)),onSuccess:n=>V(t.onSuccess(n))})),Nt=h(2,(e,t)=>{const n=new de(Gr);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),qs=h(2,(e,t)=>Nt(e,{onFailure:n=>{if(uf(n).length>0)return xe(fy(n));const s=oy(n);return s.length>0?t.onFailure(Hl(s)):xe(n)},onSuccess:t.onSuccess})),dt=h(2,(e,t)=>te(()=>{const n=Q(e),r=Es(n.length);let s=0;return fr(Vi({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),Ds=h(2,(e,t)=>te(()=>{const n=Q(e);let r=0;return Vi({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),rh=e=>{const t=new de(Xn);return t.effect_instruction_i0=$b(wn),t.effect_instruction_i1=()=>e,t},we=h(2,(e,t)=>T(e,n=>$(()=>t(n)))),sh=h(2,(e,t)=>qs(e,{onFailure:n=>eh(()=>t.onFailure(n)),onSuccess:n=>$(()=>t.onSuccess(n))})),Us=h(2,(e,t)=>Nt(e,{onFailure:n=>{const r=ay(n);switch(r._tag){case"Left":return eh(()=>t(r.left));case"Right":return xe(r.right)}},onSuccess:V})),Ji=h(2,(e,t)=>Bs(n=>Nt(n(e),{onFailure:r=>{const s=J(r);return Nt(t(s),{onFailure:o=>J(Ie(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=X(r);return Js(t(s),s)}}))),oh=h(2,(e,t)=>Ji(e,yh({onFailure:n=>Ni(n)?hr(t(iy(n))):Ge,onSuccess:()=>Ge}))),oS=h(2,(e,t)=>aS(e,t,V)),V=e=>{const t=new Qf(Ve);return t.effect_instruction_i0=e,t},te=e=>{const t=new de(vs);return t.commit=e,t},$=e=>{const t=new de(zu);return t.effect_instruction_i0=e,t},iS=h(e=>e.length===3||e.length===2&&!(zn(e[1])&&"onlyEffect"in e[1]),(e,t)=>T(e,n=>{const r=typeof t=="function"?t(n):t;return Ks(r)?fr(r,n):Qd(r)?is(s=>{r.then(o=>s(V(n)),o=>s(Se(new xS(o,"An unknown error occurred in Effect.tap"))))}):V(n)})),cS=e=>Fe(t=>{const n=t.getFiberRef(Go),r=m(n,he(()=>t.scope()));return e(Vs(Go,E(r)))}),aS=h(3,(e,t,n)=>Nt(e,{onFailure:r=>uf(r).length>0?xe(Km(ly(r))):t(),onSuccess:n})),ih=e=>{const t=new de(Xn);return t.effect_instruction_i0=Jf(wn),t.effect_instruction_i1=()=>e,t},Bs=e=>Xf(e,function(){const t=new de(Xn);return t.effect_instruction_i0=Jf(wn),t.effect_instruction_i1=n=>Uf(n)?ye(()=>this.effect_instruction_i0(rh)):ye(()=>this.effect_instruction_i0(ih)),t}),Ge=V(void 0),uS=e=>{const t=new de(Xn);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},Vi=e=>{const t=new de(Wr);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},Hi=e=>{const t=new de(Nr);return typeof(e==null?void 0:e.priority)<"u"?IS(t,e.priority):t},ch=h(2,(e,t)=>T(e,n=>we(t,r=>[n,r]))),ah=h(2,(e,t)=>T(e,n=>fr(t,n))),Js=h(2,(e,t)=>T(e,()=>t)),lS=e=>T(nS,t=>m(e,uh(t))),uh=h(2,(e,t)=>T(e.interruptAsFork(t),()=>e.await)),fS={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return F(this,arguments)}},hS={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return F(this,arguments)}},dS={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return F(this,arguments)}},lh={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return F(this,arguments)}},fh={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return F(this,arguments)}},hh={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return F(this,arguments)}},mS={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return F(this,arguments)}},gS={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return F(this,arguments)}},pS="effect/FiberRef",yS=Symbol.for(pS),_S={_A:e=>e},Gi=e=>Fe(t=>X(t.getFiberRef(e))),Wi=h(2,(e,t)=>T(Gi(e),t)),ra=h(2,(e,t)=>bS(e,()=>[void 0,t])),bS=h(2,(e,t)=>Fe(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),V(r)})),Vs=h(3,(e,t,n)=>Xb(ah(Gi(t),ra(t,n)),()=>e,r=>ra(t,r))),ke=(e,t)=>kn(e,{differ:jf(),fork:(t==null?void 0:t.fork)??Z,join:t==null?void 0:t.join}),SS=e=>{const t=mb();return kn(e,{differ:t,fork:t.empty})},wS=e=>{const t=gb(jf());return kn(e,{differ:t,fork:t.empty})},dh=e=>{const t=db();return kn(e,{differ:t,fork:t.empty})},kn=(e,t)=>({...er,[yS]:_S,initial:e,commit(){return Gi(this)},diff:(r,s)=>t.differ.diff(r,s),combine:(r,s)=>t.differ.combine(r,s),patch:r=>s=>t.differ.patch(r,s),fork:t.fork,join:t.join??((r,s)=>s)}),kS=e=>kn(e,{differ:Zc,fork:Zc.empty}),dr=j(Symbol.for("effect/FiberRef/currentContext"),()=>dh(xi())),Hs=j(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>ke(0)),mh=j(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>ke(2048)),vS=j(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>ke(Ki())),OS=j(Symbol.for("effect/FiberRef/currentLogLevel"),()=>ke(fh)),ES=j(Symbol.for("effect/FiberRef/currentLogSpan"),()=>ke(hn())),IS=h(2,(e,t)=>Vs(e,Hs,t)),TS=j(Symbol.for("effect/FiberRef/currentConcurrency"),()=>ke("unbounded")),FS=j(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>ke(!0)),$S=j(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>ke(E(hh))),RS=j(Symbol.for("effect/FiberRef/versionMismatchErrorLogLevel"),()=>ke(E(lh))),Ho=j(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>wS(Yt())),Go=j(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>ke(w(),{fork:()=>w(),join:(e,t)=>e})),Or=j(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>ke(cn,{fork:()=>cn,join:(e,t)=>e})),MS=(e,t)=>e.addFinalizer(()=>hr(t)),NS=(e,t)=>e.close(t),Gs=(e,t)=>e.fork(t),zi=(function(){class e extends globalThis.Error{commit(){return Se(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[G](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?or(ts(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,wm),e})(),gh=(e,t)=>{class n extends zi{constructor(){super(...arguments);c(this,"_tag",t)}}return Object.assign(n.prototype,e),n.prototype.name=t,n},sa=Symbol.for("effect/Cause/errors/RuntimeException"),AS=gh({[sa]:sa},"RuntimeException"),CS=Symbol.for("effect/Cause/errors/InterruptedException"),PS=e=>A(e,CS),oa=Symbol.for("effect/Cause/errors/NoSuchElement"),ph=gh({[oa]:oa},"NoSuchElementException"),ia=Symbol.for("effect/Cause/errors/UnknownException"),xS=(function(){class e extends zi{constructor(r,s){super(s??"An unknown error occurred",{cause:r});c(this,"_tag","UnknownException");c(this,"error");this.error=r}}return Object.assign(e.prototype,{[ia]:ia,name:"UnknownException"}),e})(),Ws=e=>Ks(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),ca=(e,t)=>qS(e,t!=null&&t.parallel?sr:Ie),LS=e=>J(Pe(e)),aa=e=>J(ts(e)),J=e=>{const t=new Yf(Je);return t.effect_instruction_i0=e,t},jS=e=>J(ft(e)),uo=h(2,(e,t)=>{switch(e._tag){case Je:return J(e.effect_instruction_i0);case Ve:return X(t(e.effect_instruction_i0))}}),yh=h(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case Je:return t(e.effect_instruction_i0);case Ve:return n(e.effect_instruction_i0)}}),X=e=>{const t=new Qf(Ve);return t.effect_instruction_i0=e,t},St=X(void 0),KS=h(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case Je:switch(t._tag){case Ve:return J(e.effect_instruction_i0);case Je:return J(n(e.effect_instruction_i0,t.effect_instruction_i0))}case Ve:switch(t._tag){case Ve:return X(r(e.effect_instruction_i0,t.effect_instruction_i0));case Je:return J(t.effect_instruction_i0)}}}),qS=(e,t)=>{const n=Vl(e);return en(n)?m(bt(n),pl(m(tn(n),uo(Te)),(r,s)=>m(r,KS(s,{onSuccess:(o,i)=>m(o,He(i)),onFailure:t}))),uo(Zt),uo(r=>Ot(r)),E):w()},DS=e=>({...er,[Hb]:Gb,state:Of(Wb([])),commit(){return _h(this)},blockingOn:e}),_h=e=>Zb(t=>{const n=Ps(e.state);switch(n._tag){case Wf:return t(n.effect);case js:return n.joiners.push(t),US(e,t)}},e.blockingOn),bh=(e,t)=>{const n=Ps(e.state);if(n._tag===js){Ef(e.state,zb(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},US=(e,t)=>$(()=>{const n=Ps(e.state);if(n._tag===js){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),BS=Fe(e=>X(e.currentContext)),JS=()=>BS,mr=e=>T(JS(),e),VS=h(2,(e,t)=>Vs(dr,t)(e)),HS=h(2,(e,t)=>mr(n=>VS(e,t(n)))),Yi=e=>{const t=e.currentSpan;return t!==void 0&&t._tag==="Span"?E(t):w()},GS="effect/Clock",ua=Symbol.for(GS),Qi=Pt("effect/Clock"),WS=2**31-1,la={unsafeSchedule(e,t){const n=Lo(t);if(n>WS)return ko;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},fa=(function(){const e=BigInt(1e6);if(typeof performance>"u"||typeof performance.now!="function")return()=>BigInt(Date.now())*e;let t;return()=>(t===void 0&&(t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6))),t+BigInt(Math.round(performance.now()*1e6)))})(),zS=(function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return fa;const t=fa()-e.bigint();return()=>t+e.bigint()})();var tu;tu=ua;class YS{constructor(){c(this,tu,ua);c(this,"currentTimeMillis",$(()=>this.unsafeCurrentTimeMillis()));c(this,"currentTimeNanos",$(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return zS()}scheduler(){return V(la)}sleep(t){return Vn(n=>{const r=la.unsafeSchedule(()=>n(Ge),t);return hr($(r))})}}const QS=()=>new YS,Sh="And",wh="Or",kh="InvalidData",vh="MissingData",Oh="SourceUnavailable",Eh="Unsupported",XS="effect/ConfigError",ha=Symbol.for(XS),vn={_tag:"ConfigError",[ha]:ha},Ih=(e,t)=>{const n=Object.create(vn);return n._op=Sh,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},Th=(e,t)=>{const n=Object.create(vn);return n._op=wh,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},ZS=(e,t,n={pathDelim:"."})=>{const r=Object.create(vn);return r._op=kh,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${m(this.path,gn(n.pathDelim))}: "${this.message}")`}}),r},At=(e,t,n={pathDelim:"."})=>{const r=Object.create(vn);return r._op=vh,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${m(this.path,gn(n.pathDelim))}: "${this.message}")`}}),r},ew=(e,t,n,r={pathDelim:"."})=>{const s=Object.create(vn);return s._op=Oh,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${m(this.path,gn(r.pathDelim))}: "${this.message}")`}}),s},tw=(e,t,n={pathDelim:"."})=>{const r=Object.create(vn);return r._op=Eh,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${m(this.path,gn(n.pathDelim))}: "${this.message}")`}}),r},wt=h(2,(e,t)=>{switch(e._op){case Sh:return Ih(wt(e.left,t),wt(e.right,t));case wh:return Th(wt(e.left,t),wt(e.right,t));case kh:return ZS([...t,...e.path],e.message);case vh:return At([...t,...e.path],e.message);case Oh:return ew([...t,...e.path],e.message,e.cause);case Eh:return tw([...t,...e.path],e.message)}}),nw={_tag:"Empty"},lo=h(2,(e,t)=>{let n=qi(t),r=e;for(;w_(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=Mt(s.first,Mt(s.second,n.tail));break}case"MapName":{r=Bt(r,s.f),n=n.tail;break}case"Nested":{r=Yr(r,s.name),n=n.tail;break}case"Unnested":{if(m(Pn(r),Jm(s.name)))r=Tt(r),n=n.tail;else return L(At(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return re(r)}),rw="Constant",sw="Fail",ow="Fallback",iw="Described",cw="Lazy",aw="MapOrFail",uw="Nested",lw="Primitive",fw="Sequence",hw="HashMap",dw="ZipWith";var da={};const as=(e,t)=>[...e,...t],mw="effect/ConfigProvider",ma=Symbol.for(mw),gw=Pt("effect/ConfigProvider"),pw="effect/ConfigProviderFlat",ga=Symbol.for(pw),yw=e=>({[ma]:ma,pipe(){return F(this,arguments)},...e}),_w=e=>({[ga]:ga,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),bw=e=>yw({load:t=>T(Ne(e,Yt(),t,!1),n=>Qe(Pn(n),{onNone:()=>Se(At(Yt(),`Expected a single value having structure: ${t}`)),onSome:V})),flattened:e}),Sw=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=u=>m(u,gn(t)),s=u=>u.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof da=="object"?da:{};return bw(_w({load:(u,l,f=!0)=>{const d=r(u),p=o(),g=d in p?E(p[d]):w();return m(g,Us(()=>At(u,`Expected ${d} to exist in the process context`)),T(y=>Ew(y,u,l,n,f)))},enumerateChildren:u=>$(()=>{const l=o(),p=Object.keys(l).map(g=>s(g.toUpperCase())).filter(g=>{for(let y=0;y<u.length;y++){const b=m(u,dl(y)),_=g[y];if(_===void 0||b!==_)return!1}return!0}).flatMap(g=>g.slice(u.length,u.length+1));return Xp(p)}),patch:nw}))},ww=(e,t,n,r)=>{const s=Nc(n.length,u=>u>=r.length?w():E([e(u),u+1])),o=Nc(r.length,u=>u>=n.length?w():E([t(u),u+1])),i=as(n,s),a=as(r,o);return[i,a]},kw=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},Ne=(e,t,n,r)=>{const s=n;switch(s._tag){case rw:return V(qe(s.value));case iw:return te(()=>Ne(e,t,s.config,r));case sw:return Se(At(t,s.message));case ow:return m(te(()=>Ne(e,t,s.first,r)),Vo(o=>s.condition(o)?m(Ne(e,t,s.second,r),Vo(i=>Se(Th(o,i)))):Se(o)));case cw:return te(()=>Ne(e,t,s.config(),r));case aw:return te(()=>m(Ne(e,t,s.original,r),T(dt(o=>m(s.mapOrFail(o),Us(wt(kw(t,s.original))))))));case uw:return te(()=>Ne(e,as(t,qe(s.name)),s.config,r));case lw:return m(lo(t,e.patch),T(o=>m(e.load(o,s,r),T(i=>{if(i.length===0){const a=m(tg(o),he(()=>"<n/a>"));return Se(At([],`Expected ${s.description} with name ${a}`))}return V(i)}))));case fw:return m(lo(t,e.patch),T(o=>m(e.enumerateChildren(o),T(Tw),T(i=>i.length===0?te(()=>we(Ne(e,t,s.config,!0),qe)):m(dt(i,a=>Ne(e,Ym(t,`[${a}]`),s.config,!0)),we(a=>{const u=lg(a);return u.length===0?qe(Yt()):qe(u)}))))));case hw:return te(()=>m(lo(t,e.patch),T(o=>m(e.enumerateChildren(o),T(i=>m(i,dt(a=>Ne(e,as(o,qe(a)),s.valueConfig,r)),we(a=>a.length===0?qe(Ki()):m(Iw(a),Bt(u=>h_(Mc(Q(i),u)))))))))));case dw:return te(()=>m(Ne(e,t,s.left,r),cs,T(o=>m(Ne(e,t,s.right,r),cs,T(i=>{if(ae(o)&&ae(i))return Se(Ih(o.left,i.left));if(ae(o)&&ht(i))return Se(o.left);if(ht(o)&&ae(i))return Se(i.left);if(ht(o)&&ht(i)){const a=m(t,gn(".")),u=vw(t,a),[l,f]=ww(u,u,m(o.right,Bt(re)),m(i.right,Bt(re)));return m(l,Mc(f),dt(([d,p])=>m(ch(d,p),we(([g,y])=>s.zip(g,y)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},vw=(e,t)=>n=>L(At(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),Ow=(e,t)=>e.split(new RegExp(`\\s*${To(t)}\\s*`)),Ew=(e,t,n,r,s)=>s?m(Ow(e,r),dt(o=>n.parse(o.trim())),Us(wt(t))):m(n.parse(e),sh({onFailure:wt(t),onSuccess:qe})),Iw=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),Tw=e=>m(dt(e,$w),sh({onFailure:()=>Yt(),onSuccess:jn(Qt)}),cs,we(Nm)),Fw=/^(\[(\d+)\])$/,$w=e=>{const t=e.match(Fw);if(t!==null){const n=t[2];return m(n!==void 0&&n.length>0?E(n):w(),tr(Rw))}return w()},Rw=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?w():E(t)},pa=Symbol.for("effect/Console"),Fh=Pt("effect/Console"),Mw={[pa]:pa,assert(e,...t){return $(()=>{console.assert(e,...t)})},clear:$(()=>{console.clear()}),count(e){return $(()=>{console.count(e)})},countReset(e){return $(()=>{console.countReset(e)})},debug(...e){return $(()=>{console.debug(...e)})},dir(e,t){return $(()=>{console.dir(e,t)})},dirxml(...e){return $(()=>{console.dirxml(...e)})},error(...e){return $(()=>{console.error(...e)})},group(e){return e!=null&&e.collapsed?$(()=>console.groupCollapsed(e==null?void 0:e.label)):$(()=>console.group(e==null?void 0:e.label))},groupEnd:$(()=>{console.groupEnd()}),info(...e){return $(()=>{console.info(...e)})},log(...e){return $(()=>{console.log(...e)})},table(e,t){return $(()=>{console.table(e,t)})},time(e){return $(()=>console.time(e))},timeEnd(e){return $(()=>console.timeEnd(e))},timeLog(e,...t){return $(()=>{console.timeLog(e,...t)})},trace(...e){return $(()=>{console.trace(...e)})},warn(...e){return $(()=>{console.warn(...e)})},unsafe:console},Nw="effect/Random",ya=Symbol.for(Nw),Aw=Pt("effect/Random");var nu;nu=ya;class Cw{constructor(t){c(this,"seed");c(this,nu,ya);c(this,"PRNG");this.seed=t,this.PRNG=new sm(t)}get next(){return $(()=>this.PRNG.number())}get nextBoolean(){return we(this.next,t=>t>.5)}get nextInt(){return $(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return we(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return $(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return Pw(t,n=>this.nextIntBetween(0,n))}}const Pw=(e,t)=>te(()=>m($(()=>Array.from(e)),T(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return m(r,Ds(s=>m(t(s),we(o=>xw(n,s-1,o)))),fr(Vl(n)))}))),xw=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},Lw=e=>new Cw(S(e)),_a=Symbol.for("effect/Tracer"),jw=e=>({[_a]:_a,...e}),$h=Pt("effect/Tracer"),Rh=Pt("effect/ParentSpan"),ba=(function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}})();class Kw{constructor(t,n,r,s,o,i){c(this,"name");c(this,"parent");c(this,"context");c(this,"startTime");c(this,"kind");c(this,"_tag","Span");c(this,"spanId");c(this,"traceId","native");c(this,"sampled",!0);c(this,"status");c(this,"attributes");c(this,"events",[]);c(this,"links");this.name=t,this.parent=n,this.context=r,this.startTime=o,this.kind=i,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:ba(32),this.spanId=ba(16),this.links=Array.from(s)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}addLinks(t){this.links.push(...t)}}const qw=jw({span:(e,t,n,r,s,o)=>new Kw(e,t,n,r,s,o),context:e=>e()}),Dw=m(xi(),In(Qi,QS()),In(Fh,Mw),In(Aw,Lw(Math.random())),In(gw,Sw()),In($h,qw)),us=j(Symbol.for("effect/DefaultServices/currentServices"),()=>dh(Dw)),Uw=Zn,Bw=km;class Jw extends Bw{}const Vw="Sequential",Hw="Parallel",Gw="ParallelN",Mh={_tag:Vw},Ww={_tag:Hw},zw=e=>({_tag:Gw,parallelism:e}),Wo=Mh,zo=Ww,Yo=zw;function Yw(e){return new gt(e)}function Qw(){return Yw(new Map)}const Sa=Symbol.for("effect/FiberRefs");var ru;ru=Sa;class gt{constructor(t){c(this,"locals");c(this,ru,Sa);this.locals=t}pipe(){return F(this,arguments)}}const Xw=(e,t,n,r=!1)=>{const s=e;let o=t,i=n,a=r,u;for(;u===void 0;)if(le(o)&&le(i)){const l=_e(o)[0],f=Tt(o),d=_e(i)[0],p=_e(i)[1],g=Tt(i);l.startTimeMillis<d.startTimeMillis?(i=g,a=!0):l.startTimeMillis>d.startTimeMillis?o=f:l.id<d.id?(i=g,a=!0):l.id>d.id?o=f:u=[p,a]}else u=[s.initial,!0];return u},Zw=h(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const i=s[0][1];if(!s[0][0][R](t)){if(!r.has(o)){if(M(i,o.initial))return;r.set(o,[[t,o.join(o.initial,i)]]);return}const a=r.get(o),[u,l]=Xw(o,a,s);if(l){const f=o.diff(u,i),d=a[0][1],p=o.join(d,o.patch(f)(d));if(!M(d,p)){let g;const y=a[0][0];y[R](t)?g=[[y,p],...a.slice(1)]:g=[[t,p],...a],r.set(o,g)}}}}),new gt(r)}),e0=h(2,(e,t)=>{const n=new Map;return Nh(e,n,t),new gt(n)}),Nh=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],i=s.patch(s.fork)(o);M(o,i)?t.set(s,r):t.set(s,[[n,i],...r])})},Ah=h(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new gt(n)}),t0=h(2,(e,t)=>e.locals.has(t)?E(_e(e.locals.get(t))[1]):w()),Hn=h(2,(e,t)=>m(t0(e,t),he(()=>t.initial))),Qo=h(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new gt(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return Xo(s,t,n,r),new gt(s)}),Xo=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(le(s)){const[i,a]=_e(s);if(i[R](t)){if(M(a,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},n0=h(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new gt(new Map(t));const r=new Map(e.locals);return n!==void 0&&Nh(e,r,n),t.forEach(([s,o])=>{o.length===1?Xo(r,o[0][0],s,o[0][1]):o.forEach(([i,a])=>{Xo(r,i,s,a)})}),new gt(r)}),r0=Hn,s0=n0,o0=Qw,Ch="Empty",Ph="Add",xh="Remove",Lh="Update",jh="AndThen",i0={_tag:Ch},c0=(e,t)=>{const n=new Map(e.locals);let r=i0;for(const[s,o]of t.locals.entries()){const i=_e(o)[1],a=n.get(s);if(a!==void 0){const u=_e(a)[1];M(u,i)||(r=fo({_tag:Lh,fiberRef:s,patch:s.diff(u,i)})(r))}else r=fo({_tag:Ph,fiberRef:s,value:i})(r);n.delete(s)}for(const[s]of n.entries())r=fo({_tag:xh,fiberRef:s})(r);return r},fo=h(2,(e,t)=>({_tag:jh,first:e,second:t})),a0=h(3,(e,t,n)=>{let r=n,s=qe(e);for(;le(s);){const o=_e(s),i=Tt(s);switch(o._tag){case Ch:{s=i;break}case Ph:{r=Qo(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=i;break}case xh:{r=Ah(r,o.fiberRef),s=i;break}case Lh:{const a=Hn(r,o.fiberRef);r=Qo(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(a)}),s=i;break}case jh:{s=Yr(o.first)(Yr(o.second)(i));break}}}return r}),u0=c0,l0=a0,zs="effect/FiberStatus",Ct=Symbol.for(zs),ls="Done",wa="Running",ka="Suspended",f0=Y(`${zs}-${ls}`);var su;class h0{constructor(){c(this,su,Ct);c(this,"_tag",ls)}[(su=Ct,N)](){return f0}[R](t){return Xi(t)&&t._tag===ls}}var ou;class d0{constructor(t){c(this,"runtimeFlags");c(this,ou,Ct);c(this,"_tag",wa);this.runtimeFlags=t}[(ou=Ct,N)](){return m(S(zs),q(S(this._tag)),q(S(this.runtimeFlags)),W(this))}[R](t){return Xi(t)&&t._tag===wa&&this.runtimeFlags===t.runtimeFlags}}var iu;class m0{constructor(t,n){c(this,"runtimeFlags");c(this,"blockingOn");c(this,iu,Ct);c(this,"_tag",ka);this.runtimeFlags=t,this.blockingOn=n}[(iu=Ct,N)](){return m(S(zs),q(S(this._tag)),q(S(this.runtimeFlags)),q(S(this.blockingOn)),W(this))}[R](t){return Xi(t)&&t._tag===ka&&this.runtimeFlags===t.runtimeFlags&&M(this.blockingOn,t.blockingOn)}}const g0=new h0,p0=e=>new d0(e),y0=(e,t)=>new m0(e,t),Xi=e=>A(e,Ct),_0=e=>e._tag===ls,b0=g0,Kh=p0,S0=y0,w0=_0,k0=fS,v0=hS,O0=dS,E0=lh,I0=fh,T0=hh,F0=mS,$0=gS,R0=m(Qt,ll(e=>e.ordinal)),M0=Pm(R0),N0=e=>{switch(e){case"All":return k0;case"Debug":return T0;case"Error":return O0;case"Fatal":return v0;case"Info":return I0;case"Trace":return F0;case"None":return $0;case"Warning":return E0}},A0=Symbol.for("effect/Micro"),fs=Symbol.for("effect/Micro/MicroExit"),va=Symbol.for("effect/Micro/MicroCause"),C0={_E:Z};var cu;class qh extends globalThis.Error{constructor(n,r,s){const o=`MicroCause.${n}`;let i,a,u;if(r instanceof globalThis.Error){i=`(${o}) ${r.name}`,a=r.message;const l=a.split(`
`).length;u=r.stack?`(${o}) ${r.stack.split(`
`).slice(0,l+3).join(`
`)}`:`${i}: ${a}`}else i=o,a=Wt(r,0),u=`${i}: ${a}`;s.length>0&&(u+=`
    ${s.join(`
    `)}`);super(a);c(this,"_tag");c(this,"traces");c(this,cu);this._tag=n,this.traces=s,this[va]=C0,this.name=i,this.stack=u}pipe(){return F(this,arguments)}toString(){return this.stack}[(cu=va,G)](){return this.stack}}class P0 extends qh{constructor(n,r=[]){super("Die",n,r);c(this,"defect");this.defect=n}}const x0=(e,t=[])=>new P0(e,t);class L0 extends qh{constructor(t=[]){super("Interrupt","interrupted",t)}}const j0=(e=[])=>new L0(e),K0=e=>e._tag==="Interrupt",Oa=Symbol.for("effect/Micro/MicroFiber"),q0={_A:Z,_E:Z};var au;au=Oa;class D0{constructor(t,n=!0){c(this,"context");c(this,"interruptible");c(this,au);c(this,"_stack",[]);c(this,"_observers",[]);c(this,"_exit");c(this,"_children");c(this,"currentOpCount",0);c(this,"_interrupted",!1);c(this,"_yielded");this.context=t,this.interruptible=n,this[Oa]=q0}getRef(t){return Ay(this.context,t)}addObserver(t){return this._exit?(t(this._exit),Ud):(this._observers.push(t),()=>{const n=this._observers.indexOf(t);n>=0&&this._observers.splice(n,1)})}unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(rc))}unsafePoll(){return this._exit}evaluate(t){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(t);if(n===Er)return;const r=Ea.interruptChildren&&Ea.interruptChildren(this);if(r!==void 0)return this.evaluate(ds(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(t){let n=!1,r=t;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(sc).shouldYield(this)){n=!0;const s=r;r=ds(H0,()=>s)}if(r=r[Zo](this),r===Er){const s=this._yielded;return fs in s?(this._yielded=void 0,s):Er}}}catch(s){return A(r,Zo)?ei(s):ei(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(t){for(;;){const n=this._stack.pop();if(!n)return;const r=n[hs]&&n[hs](this);if(r)return{[t]:r};if(n[t])return n}}yieldWith(t){return this._yielded=t,Er}children(){return this._children??(this._children=new Set)}}const Ea=j("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),Dh=Symbol.for("effect/Micro/identifier"),ne=Symbol.for("effect/Micro/args"),Zo=Symbol.for("effect/Micro/evaluate"),mn=Symbol.for("effect/Micro/successCont"),Ht=Symbol.for("effect/Micro/failureCont"),hs=Symbol.for("effect/Micro/ensureCont"),Er=Symbol.for("effect/Micro/Yield"),U0={_A:Z,_E:Z,_R:Z},B0={...Uw,_op:"Micro",[A0]:U0,pipe(){return F(this,arguments)},[Symbol.iterator](){return new Bu(new Yn(this))},toJSON(){return{_id:"Micro",op:this[Dh],...ne in this?{args:this[ne]}:void 0}},toString(){return ue(this)},[G](){return ue(this)}};function J0(e){return ei("Micro.evaluate: Not implemented")}const Ys=e=>({...B0,[Dh]:e.op,[Zo]:e.eval??J0,[mn]:e.contA,[Ht]:e.contE,[hs]:e.ensure}),Zi=e=>{const t=Ys(e);return function(){const n=Object.create(t);return n[ne]=e.single===!1?arguments:arguments[0],n}},Uh=e=>{const t={...Ys(e),[fs]:fs,_tag:e.op,get[e.prop](){return this[ne]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[ne]}},[R](n){return z0(n)&&n._tag===e.op&&M(this[ne],n[ne])},[N](){return W(this,q(Y(e.op))(S(this[ne])))}};return function(n){const r=Object.create(t);return r[ne]=n,r[mn]=void 0,r[Ht]=void 0,r[hs]=void 0,r}},ec=Uh({op:"Success",prop:"value",eval(e){const t=e.getCont(mn);return t?t[mn](this[ne],e):e.yieldWith(this)}}),Bh=Uh({op:"Failure",prop:"cause",eval(e){let t=e.getCont(Ht);for(;K0(this[ne])&&t&&e.interruptible;)t=e.getCont(Ht);return t?t[Ht](this[ne],e):e.yieldWith(this)}}),V0=Zi({op:"Yield",eval(e){let t=!1;return e.getRef(sc).scheduleTask(()=>{t||e.evaluate(Y0)},this[ne]??0),e.yieldWith(()=>{t=!0})}}),H0=V0(0),G0=ec(void 0),tc=Zi({op:"WithMicroFiber",eval(e){return this[ne](e)}}),ds=h(2,(e,t)=>{const n=Object.create(W0);return n[ne]=e,n[mn]=t,n}),W0=Ys({op:"OnSuccess",eval(e){return e._stack.push(this),this[ne]}}),z0=e=>A(e,fs),Jh=ec,nc=Bh,rc=nc(j0()),ei=e=>nc(x0(e)),Y0=Jh(void 0),Q0="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class Vh{constructor(){c(this,"tasks",[]);c(this,"running",!1);c(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,Q0(this.afterScheduled))}runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return t.currentOpCount>=t.getRef(ek)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const X0=h(2,(e,t)=>tc(n=>{const r=n.context;return n.context=t(r),rk(e,()=>(n.context=r,G0))})),Z0=h(2,(e,t)=>X0(e,bf(t)));class ek extends Sf()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class sc extends Sf()("effect/Micro/currentScheduler",{defaultValue:()=>new Vh}){}const tk=h(2,(e,t)=>{const n=Object.create(nk);return n[ne]=e,n[mn]=t.onSuccess,n[Ht]=t.onFailure,n}),nk=Ys({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[ne]}}),rk=h(2,(e,t)=>ok(n=>tk(n(e),{onFailure:r=>ds(t(nc(r)),()=>Bh(r)),onSuccess:r=>ds(t(Jh(r)),()=>ec(r))}))),Hh=Zi({op:"SetInterruptible",ensure(e){if(e.interruptible=this[ne],e._interrupted&&e.interruptible)return()=>rc}}),sk=e=>tc(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(Hh(!1)),t._interrupted?rc:e)),ok=e=>tc(t=>t.interruptible?(t.interruptible=!1,t._stack.push(Hh(!0)),e(sk)):e(Z)),ik=(e,t)=>{const n=new D0(sc.context(new Vh));return n.evaluate(e),n};class Gh{constructor(){c(this,"buckets",[])}scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class ck{constructor(t){c(this,"maxNextTickBeforeTimer");c(this,"running",!1);c(this,"tasks",new Gh);this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(mh)?t.getFiberRef(Hs):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const Wh=j(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new ck(2048));class ak{constructor(){c(this,"tasks",new Gh);c(this,"deferred",!1)}scheduleTask(t,n){this.deferred?Wh.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(mh)?t.getFiberRef(Hs):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const zh=j(Symbol.for("effect/FiberRef/currentScheduler"),()=>ke(Wh)),Yh=j(Symbol.for("effect/FiberRef/currentRequestMap"),()=>ke(new Map)),Ia=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return Wi(TS,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},Qh=e=>e.replace(/[\s="]/g,"_"),uk=e=>t=>`${Qh(t.label)}=${e-t.startTime}ms`,Xh="effect/MetricLabel",ti=Symbol.for(Xh);var uu;class lk{constructor(t,n){c(this,"key");c(this,"value");c(this,uu,ti);c(this,"_hash");this.key=t,this.value=n,this._hash=Y(Xh+this.key+this.value)}[(uu=ti,N)](){return this._hash}[R](t){return hk(t)&&this.key===t.key&&this.value===t.value}pipe(){return F(this,arguments)}}const fk=(e,t)=>new lk(e,t),hk=e=>A(e,ti),oc="InterruptSignal",ic="Stateful",cc="Resume",ac="YieldNow",ho=e=>({_tag:oc,cause:e}),qr=e=>({_tag:ic,onFiber:e}),jt=e=>({_tag:cc,effect:e}),dk=()=>({_tag:ac}),mk="effect/FiberScope",ms=Symbol.for(mk);var lu;lu=ms;class gk{constructor(){c(this,lu,ms);c(this,"fiberId",fn);c(this,"roots",new Set)}add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}var fu;fu=ms;class pk{constructor(t,n){c(this,"fiberId");c(this,"parent");c(this,fu,ms);this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(qr(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const yk=e=>new pk(e.id(),e),uc=j(Symbol.for("effect/FiberScope/Global"),()=>new gk),_k="effect/Fiber",bk=Symbol.for(_k),Sk={_E:e=>e,_A:e=>e},wk="effect/Fiber",kk=Symbol.for(wk),Zh=e=>ah(nh(e.await),e.inheritAll);({...er});const pt="effect/FiberCurrent",vk="effect/Logger",Ok=Symbol.for(vk),Ek={_Message:e=>e,_Output:e=>e},lc=e=>({[Ok]:Ek,log:e,pipe(){return F(this,arguments)}}),Ik=/^[^\s"=]*$/,Tk=(e,t)=>({annotations:n,cause:r,date:s,fiberId:o,logLevel:i,message:a,spans:u})=>{const l=y=>y.match(Ik)?y:e(y),f=(y,b)=>`${Qh(y)}=${l(b)}`,d=(y,b)=>" "+f(y,b);let p=f("timestamp",s.toISOString());p+=d("level",i.label),p+=d("fiber",Tf(o));const g=Wm(a);for(let y=0;y<g.length;y++)p+=d("message",Wt(g[y],t));ny(r)||(p+=d("cause",or(r,{renderErrorCause:!0})));for(const y of u)p+=" "+uk(s.getTime())(y);for(const[y,b]of n)p+=d(y,Wt(b,t));return p},Fk=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,$k=lc(Tk(Fk)),Rk=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null;Rk&&process.stdout.isTTY;const ed="effect/MetricBoundaries",ni=Symbol.for(ed);var hu;class Mk{constructor(t){c(this,"values");c(this,hu,ni);c(this,"_hash");this.values=t,this._hash=m(Y(ed),q(Qn(this.values)))}[(hu=ni,N)](){return this._hash}[R](t){return Nk(t)&&M(this.values,t.values)}pipe(){return F(this,arguments)}}const Nk=e=>A(e,ni),Ak=e=>{const t=m(e,fl(Te(Number.POSITIVE_INFINITY)),hg);return new Mk(t)},Ck=e=>m(Gm(e.count-1,t=>e.start*Math.pow(e.factor,t)),Fs,Ak),Pk="effect/MetricKeyType",td=Symbol.for(Pk),nd="effect/MetricKeyType/Counter",ri=Symbol.for(nd),xk="effect/MetricKeyType/Frequency",Lk=Symbol.for(xk),jk="effect/MetricKeyType/Gauge",Kk=Symbol.for(jk),rd="effect/MetricKeyType/Histogram",si=Symbol.for(rd),qk="effect/MetricKeyType/Summary",Dk=Symbol.for(qk),sd={_In:e=>e,_Out:e=>e};var du,mu;class Uk{constructor(t,n){c(this,"incremental");c(this,"bigint");c(this,mu,sd);c(this,du,ri);c(this,"_hash");this.incremental=t,this.bigint=n,this._hash=Y(nd)}[(mu=td,du=ri,N)](){return this._hash}[R](t){return od(t)}pipe(){return F(this,arguments)}}var gu,pu;class Bk{constructor(t){c(this,"boundaries");c(this,pu,sd);c(this,gu,si);c(this,"_hash");this.boundaries=t,this._hash=m(Y(rd),q(S(this.boundaries)))}[(pu=td,gu=si,N)](){return this._hash}[R](t){return id(t)&&M(this.boundaries,t.boundaries)}pipe(){return F(this,arguments)}}const Jk=e=>new Uk((e==null?void 0:e.incremental)??!1,(e==null?void 0:e.bigint)??!1),Vk=e=>new Bk(e),od=e=>A(e,ri),Hk=e=>A(e,Lk),Gk=e=>A(e,Kk),id=e=>A(e,si),Wk=e=>A(e,Dk),zk="effect/MetricKey",cd=Symbol.for(zk),Yk={_Type:e=>e},Qk=bi(M);var yu;class fc{constructor(t,n,r,s=[]){c(this,"name");c(this,"keyType");c(this,"description");c(this,"tags");c(this,yu,Yk);c(this,"_hash");this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=m(Y(this.name+this.description),q(S(this.keyType)),q(Qn(this.tags)))}[(yu=cd,N)](){return this._hash}[R](t){return Xk(t)&&this.name===t.name&&M(this.keyType,t.keyType)&&M(this.description,t.description)&&Qk(this.tags,t.tags)}pipe(){return F(this,arguments)}}const Xk=e=>A(e,cd),Zk=(e,t)=>new fc(e,Jk(t),Os(t==null?void 0:t.description)),ev=(e,t,n)=>new fc(e,Vk(t),Os(n)),tv=h(2,(e,t)=>t.length===0?e:new fc(e.name,e.keyType,e.description,Cr(e.tags,t))),Ta=Symbol.for("effect/MutableHashMap"),nv={[Ta]:Ta,[Symbol.iterator](){return new hc(this)},toString(){return ue(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(se)}},[G](){return this.toJSON()},pipe(){return F(this,arguments)}};class hc{constructor(t){c(this,"self");c(this,"referentialIterator");c(this,"bucketIterator");this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new rv(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new hc(this.self)}}class rv{constructor(t){c(this,"backing");c(this,"currentBucket");this.backing=t}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const sv=()=>{const e=Object.create(nv);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},yt=h(2,(e,t)=>{if(Vr(t)===!1)return e.referential.has(t)?E(e.referential.get(t)):w();const n=t[N](),r=e.buckets.get(n);return r===void 0?w():ov(e,r,t)}),ov=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[R](t[s][0])){const i=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),E(i)}return w()},Tn=h(2,(e,t)=>me(yt(e,t))),Fn=h(3,(e,t,n)=>{if(Vr(t)===!1)return e.referential.set(t,n),e;const r=t[N](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(iv(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),iv=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[R](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},cv="effect/MetricState",gr=Symbol.for(cv),ad="effect/MetricState/Counter",oi=Symbol.for(ad),ud="effect/MetricState/Frequency",ii=Symbol.for(ud),ld="effect/MetricState/Gauge",ci=Symbol.for(ld),fd="effect/MetricState/Histogram",ai=Symbol.for(fd),hd="effect/MetricState/Summary",ui=Symbol.for(hd),pr={_A:e=>e};var _u,bu;class av{constructor(t){c(this,"count");c(this,bu,pr);c(this,_u,oi);this.count=t}[(bu=gr,_u=oi,N)](){return m(S(ad),q(S(this.count)),W(this))}[R](t){return bv(t)&&this.count===t.count}pipe(){return F(this,arguments)}}const uv=bi(M);var Su,wu;class lv{constructor(t){c(this,"occurrences");c(this,wu,pr);c(this,Su,ii);c(this,"_hash");this.occurrences=t}[(wu=gr,Su=ii,N)](){return m(Y(ud),q(Qn(Q(this.occurrences.entries()))),W(this))}[R](t){return Sv(t)&&uv(Q(this.occurrences.entries()),Q(t.occurrences.entries()))}pipe(){return F(this,arguments)}}var ku,vu;class fv{constructor(t){c(this,"value");c(this,vu,pr);c(this,ku,ci);this.value=t}[(vu=gr,ku=ci,N)](){return m(S(ld),q(S(this.value)),W(this))}[R](t){return wv(t)&&this.value===t.value}pipe(){return F(this,arguments)}}var Ou,Eu;class hv{constructor(t,n,r,s,o){c(this,"buckets");c(this,"count");c(this,"min");c(this,"max");c(this,"sum");c(this,Eu,pr);c(this,Ou,ai);this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[(Eu=gr,Ou=ai,N)](){return m(S(fd),q(S(this.buckets)),q(S(this.count)),q(S(this.min)),q(S(this.max)),q(S(this.sum)),W(this))}[R](t){return kv(t)&&M(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return F(this,arguments)}}var Iu,Tu;class dv{constructor(t,n,r,s,o,i){c(this,"error");c(this,"quantiles");c(this,"count");c(this,"min");c(this,"max");c(this,"sum");c(this,Tu,pr);c(this,Iu,ui);this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=i}[(Tu=gr,Iu=ui,N)](){return m(S(hd),q(S(this.error)),q(S(this.quantiles)),q(S(this.count)),q(S(this.min)),q(S(this.max)),q(S(this.sum)),W(this))}[R](t){return vv(t)&&this.error===t.error&&M(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return F(this,arguments)}}const mv=e=>new av(e),gv=e=>new lv(e),pv=e=>new fv(e),yv=e=>new hv(e.buckets,e.count,e.min,e.max,e.sum),_v=e=>new dv(e.error,e.quantiles,e.count,e.min,e.max,e.sum),bv=e=>A(e,oi),Sv=e=>A(e,ii),wv=e=>A(e,ci),kv=e=>A(e,ai),vv=e=>A(e,ui),Ov="effect/MetricHook",Ev=Symbol.for(Ov),Iv={_In:e=>e,_Out:e=>e},yr=e=>({[Ev]:Iv,pipe(){return F(this,arguments)},...e}),Fa=BigInt(0),Tv=e=>{let t=e.keyType.bigint?Fa:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=Fa:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return yr({get:()=>mv(t),update:r,modify:r})},Fv=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return yr({get:()=>gv(t),update:n,modify:n})},$v=(e,t)=>{let n=t;return yr({get:()=>pv(n),update:r=>{n=r},modify:r=>{n=n+r}})},Rv=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float64Array(n);let o=0,i=0,a=Number.MAX_VALUE,u=Number.MIN_VALUE;m(t,jn(Qt),Bt((d,p)=>{s[p]=d}));const l=d=>{let p=0,g=n;for(;p!==g;){const y=Math.floor(p+(g-p)/2),b=s[y];d<=b?g=y:p=y,g===p+1&&(d<=s[p]?g=p:p=g)}r[p]=r[p]+1,o=o+1,i=i+d,d<a&&(a=d),d>u&&(u=d)},f=()=>{const d=Es(n);let p=0;for(let g=0;g<n;g++){const y=s[g],b=r[g];p=p+b,d[g]=[y,p]}return d};return yr({get:()=>yv({buckets:f(),count:o,min:a,max:u,sum:i}),update:l,modify:l})},Mv=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=m(s,jn(Qt)),i=Es(r);let a=0,u=0,l=0,f=0,d=0;const p=y=>{const b=[];let _=0;for(;_!==r-1;){const v=i[_];if(v!=null){const[K,O]=v,P=xo(y-K);e_(P,vf)&&Zy(P,n)&&b.push(O)}_=_+1}return Nv(t,o,jn(b,Qt))},g=(y,b)=>{if(r>0){a=a+1;const _=a%r;i[_]=[b,y]}f=u===0?y:Math.min(f,y),d=u===0?y:Math.max(d,y),u=u+1,l=l+y};return yr({get:()=>_v({error:t,quantiles:p(Date.now()),count:u,min:f,max:d,sum:l}),update:([y,b])=>g(y,b),modify:([y,b])=>g(y,b)})},Nv=(e,t,n)=>{const r=n.length;if(!le(t))return Yt();const s=t[0],o=t.slice(1),i=$a(e,r,w(),0,s,n),a=qe(i);return o.forEach(u=>{a.push($a(e,r,i.value,i.consumed,u,i.rest))}),Bt(a,u=>[u.quantile,u.value])},$a=(e,t,n,r,s,o)=>{let i=e,a=t,u=n,l=r,f=s,d=o,p=e,g=t,y=n,b=r,_=s,v=o;for(;;){if(!le(d))return{quantile:f,value:w(),consumed:l,rest:[]};if(f===1)return{quantile:f,value:E(ml(d)),consumed:l+d.length,rest:[]};const K=_e(d),O=rg(d,k=>k===K),P=f*a,B=i/2*P,I=l+O[0].length,x=Math.abs(I-P);if(I<P-B){p=i,g=a,y=Pn(d),b=I,_=f,v=O[1],i=p,a=g,u=y,l=b,f=_,d=v;continue}if(I>P+B){const k=oe(u)?E(K):u;return{quantile:f,value:k,consumed:l,rest:d}}switch(u._tag){case"None":{p=i,g=a,y=Pn(d),b=I,_=f,v=O[1],i=p,a=g,u=y,l=b,f=_,d=v;continue}case"Some":{const k=Math.abs(P-u.value);if(x<k){p=i,g=a,y=Pn(d),b=I,_=f,v=O[1],i=p,a=g,u=y,l=b,f=_,d=v;continue}return{quantile:f,value:E(u.value),consumed:l,rest:d}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},Av="effect/MetricPair",Cv=Symbol.for(Av),Pv={_Type:e=>e},xv=(e,t)=>({[Cv]:Pv,metricKey:e,metricState:t,pipe(){return F(this,arguments)}}),Lv="effect/MetricRegistry",Ra=Symbol.for(Lv);var Fu;Fu=Ra;class jv{constructor(){c(this,Fu,Ra);c(this,"map",sv())}snapshot(){const t=[];for(const[n,r]of this.map)t.push(xv(n,r.get()));return t}get(t){const n=m(this.map,yt(t),rt);if(n==null){if(od(t.keyType))return this.getCounter(t);if(Gk(t.keyType))return this.getGauge(t);if(Hk(t.keyType))return this.getFrequency(t);if(id(t.keyType))return this.getHistogram(t);if(Wk(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=m(this.map,yt(t),rt);if(n==null){const r=Tv(t);m(this.map,Tn(t))||m(this.map,Fn(t,r)),n=r}return n}getFrequency(t){let n=m(this.map,yt(t),rt);if(n==null){const r=Fv(t);m(this.map,Tn(t))||m(this.map,Fn(t,r)),n=r}return n}getGauge(t){let n=m(this.map,yt(t),rt);if(n==null){const r=$v(t,t.keyType.bigint?BigInt(0):0);m(this.map,Tn(t))||m(this.map,Fn(t,r)),n=r}return n}getHistogram(t){let n=m(this.map,yt(t),rt);if(n==null){const r=Rv(t);m(this.map,Tn(t))||m(this.map,Fn(t,r)),n=r}return n}getSummary(t){let n=m(this.map,yt(t),rt);if(n==null){const r=Mv(t);m(this.map,Tn(t))||m(this.map,Fn(t,r)),n=r}return n}}const Kv=()=>new jv,qv="effect/Metric",Dv=Symbol.for(qv),Uv={_Type:e=>e,_In:e=>e,_Out:e=>e},Ma=j(Symbol.for("effect/Metric/globalMetricRegistry"),()=>Kv()),dd=function(e,t,n,r){const s=Object.assign(o=>iS(o,i=>Hv(s,i)),{[Dv]:Uv,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return F(this,arguments)}});return s},Qs=(e,t)=>md(Zk(e,t)),md=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=Ma.get(e)),t;let o=n.get(s);return o!==void 0||(o=Ma.get(tv(e,s)),n.set(s,o)),o};return dd(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},Bv=(e,t,n)=>md(ev(e,t,n)),Jv=h(3,(e,t,n)=>Vv(e,[fk(t,n)])),Vv=h(2,(e,t)=>dd(e.keyType,(n,r)=>e.unsafeUpdate(n,Cr(t,r)),n=>e.unsafeValue(Cr(t,n)),(n,r)=>e.unsafeModify(n,Cr(t,r)))),Hv=h(2,(e,t)=>Wi(Ho,n=>$(()=>e.unsafeUpdate(t,n))));({..._i});const Gv=h(2,(e,t)=>Wi(Yh,n=>$(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,bh(r.result,t))}}))),Wv="effect/Supervisor",Xs=Symbol.for(Wv),dc={_T:e=>e};var $u;$u=Xs;const Sc=class Sc{constructor(t,n){c(this,"underlying");c(this,"value0");c(this,$u,dc);this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new Sc(this,m(this.value,we(t)))}zip(t){return new ps(this,t)}};let gs=Sc;var Ru;Ru=Xs;const wc=class wc{constructor(t,n){c(this,"left");c(this,"right");c(this,"_tag","Zip");c(this,Ru,dc);this.left=t,this.right=n}get value(){return ch(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new gs(this,m(this.value,we(t)))}zip(t){return new wc(this,t)}};let ps=wc;const gd=e=>A(e,Xs)&&Uu(e,"Zip");var Mu;Mu=Xs;class zv{constructor(t){c(this,"effect");c(this,Mu,dc);this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new gs(this,m(this.value,we(t)))}zip(t){return new ps(this,t)}onRun(t,n){return t()}}const Yv=e=>new zv(e),Zs=j("effect/Supervisor/none",()=>Yv(Ge)),Qv=Sn,pd="Empty",yd="AddSupervisor",_d="RemoveSupervisor",bd="AndThen",Ln={_tag:pd},Dr=(e,t)=>({_tag:bd,first:e,second:t}),Xv=(e,t)=>Zv(t,Te(e)),Zv=(e,t)=>{let n=e,r=t;for(;en(r);){const s=tn(r);switch(s._tag){case pd:{r=bt(r);break}case yd:{n=n.zip(s.supervisor),r=bt(r);break}case _d:{n=li(n,s.supervisor),r=bt(r);break}case bd:{r=He(s.first)(He(s.second)(bt(r)));break}}}return n},li=(e,t)=>M(e,t)?Zs:gd(e)?li(e.left,t).zip(li(e.right,t)):e,ys=e=>M(e,Zs)?$t():gd(e)?m(ys(e.left),Dn(ys(e.right))):Mi(e),eO=(e,t)=>{if(M(e,t))return Ln;const n=ys(e),r=ys(t),s=m(r,qc(n),es(Ln,(i,a)=>Dr(i,{_tag:yd,supervisor:a}))),o=m(n,qc(r),es(Ln,(i,a)=>Dr(i,{_tag:_d,supervisor:a})));return Dr(s,o)},tO=Qv({empty:Ln,patch:Xv,combine:Dr,diff:eO}),nO=Qs("effect_fiber_started",{incremental:!0}),Na=Qs("effect_fiber_active"),rO=Qs("effect_fiber_successes",{incremental:!0}),sO=Qs("effect_fiber_failures",{incremental:!0}),oO=Jv(Bv("effect_fiber_lifetimes",Ck({start:.5,factor:2,count:35})),"time_unit","milliseconds"),$n="Continue",iO="Done",Aa="Yield",cO={_E:e=>e,_A:e=>e},Ir=e=>{throw new Error(`BUG: FiberRuntime - ${Wt(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},et=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),tt=j("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),Rn={[Hr]:(e,t,n)=>ye(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>X(X(n)),[Gr]:(e,t,n)=>ye(()=>t.effect_instruction_i2(n)),[pi]:(e,t,n)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),lt(e.currentRuntimeFlags)&&e.isInterrupted()?J(e.getInterruptedCause()):X(n)),[Wr]:(e,t,n)=>(ye(()=>t.effect_instruction_i2(n)),ye(()=>t.effect_instruction_i0())?(e.pushStack(t),ye(()=>t.effect_instruction_i1())):Ge),[Mr]:(e,t,n)=>{for(;;){const r=ye(()=>t.effect_instruction_i0.next(n));if(r.done)return X(r.value);const s=im(r.value);if(Ws(s)){if(s._tag==="Failure")return s}else return e.pushStack(t),s;n=s.value}}},aO={[oc]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),lt(t)?J(r.cause):n),[cc]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[ic]:(e,t,n,r)=>(r.onFiber(e,Kh(t)),n),[ac]:(e,t,n,r)=>T(Hi(),()=>n)},uO=e=>Ds(Rb(e),t=>It(Jb(t),([n,r])=>{const s=new Map,o=[];for(const a of r){o.push(Ot(a));for(const u of a)s.set(u.request,u)}const i=o.flat();return Vs(vO(n.runAll(o),i,()=>i.forEach(a=>{a.listeners.interrupted=!0})),Yh,s)},!1,!1)),lO=yi();var Nu,Au;class Sd extends Jw{constructor(n,r,s){super();c(this,Au,Sk);c(this,Nu,cO);c(this,"_fiberRefs");c(this,"_fiberId");c(this,"_queue",new Array);c(this,"_children",null);c(this,"_observers",new Array);c(this,"_running",!1);c(this,"_stack",[]);c(this,"_asyncInterruptor",null);c(this,"_asyncBlockingOn",null);c(this,"_exitValue",null);c(this,"_steps",[]);c(this,"_isYielding",!1);c(this,"currentRuntimeFlags");c(this,"currentOpCount",0);c(this,"currentSupervisor");c(this,"currentScheduler");c(this,"currentTracer");c(this,"currentSpan");c(this,"currentContext");c(this,"currentDefaultServices");c(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this.currentRuntimeFlags=s,this._fiberId=n,this._fiberRefs=r,Xc(s)){const o=this.getFiberRef(Ho);nO.unsafeUpdate(1,o),Na.unsafeUpdate(1,o)}this.refreshRefCache()}commit(){return Zh(this)}id(){return this._fiberId}resume(n){this.tell(jt(n))}get status(){return this.ask((n,r)=>r)}get runtimeFlags(){return this.ask((n,r)=>w0(r)?n.currentRuntimeFlags:r.runtimeFlags)}scope(){return yk(this)}get children(){return this.ask(n=>Array.from(n.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Or)}fiberRefs(){return this.ask(n=>n.getFiberRefs())}ask(n){return te(()=>{const r=DS(this._fiberId);return this.tell(qr((s,o)=>{bh(r,$(()=>n(s,o)))})),_h(r)})}tell(n){this._queue.push(n),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return Vn(n=>{const r=s=>n(V(s));return this.tell(qr((s,o)=>{s._exitValue!==null?r(this._exitValue):s.addObserver(r)})),$(()=>this.tell(qr((s,o)=>{s.removeObserver(r)})))},this.id())}get inheritAll(){return Fe((n,r)=>{const s=n.id(),o=n.getFiberRefs(),i=r.runtimeFlags,a=this.getFiberRefs(),u=Zw(o,s,a);n.setFiberRefs(u);const l=n.getFiberRef(ja),f=m(jr(i,l),ea(wn),ea(Jo));return uS(f)})}get poll(){return $(()=>Os(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(n){return $(()=>this.tell(ho(ft(n))))}unsafeInterruptAsFork(n){this.tell(ho(ft(n)))}addObserver(n){this._exitValue!==null?n(this._exitValue):this._observers.push(n)}removeObserver(n){this._observers=this._observers.filter(r=>r!==n)}getFiberRefs(){return this.setFiberRef(ja,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(n){this._fiberRefs=Ah(this._fiberRefs,n)}getFiberRef(n){return this._fiberRefs.locals.has(n)?this._fiberRefs.locals.get(n)[0][1]:n.initial}setFiberRef(n,r){this._fiberRefs=Qo(this._fiberRefs,{fiberId:this._fiberId,fiberRef:n,value:r}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(us),this.currentTracer=this.currentDefaultServices.unsafeMap.get($h.key),this.currentSupervisor=this.getFiberRef(kO),this.currentScheduler=this.getFiberRef(zh),this.currentContext=this.getFiberRef(dr),this.currentSpan=this.currentContext.unsafeMap.get(Rh.key)}setFiberRefs(n){this._fiberRefs=n,this.refreshRefCache()}addChild(n){this.getChildren().add(n)}removeChild(n){this.getChildren().delete(n)}transferChildren(n){const r=this._children;if(this._children=null,r!==null&&r.size>0)for(const s of r)s._exitValue===null&&n.add(this.currentRuntimeFlags,s)}drainQueueOnCurrentThread(){let n=!0;for(;n;){let r=$n;const s=globalThis[pt];globalThis[pt]=this;try{for(;r===$n;)r=this._queue.length===0?iO:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[pt]=s}this._queue.length>0&&!this._running?(this._running=!0,r===Aa?(this.drainQueueLaterOnExecutor(),n=!1):n=!0):n=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(Hs))}drainQueueWhileRunning(n,r){let s=r;for(;this._queue.length>0;){const o=this._queue.splice(0,1)[0];s=aO[o._tag](this,n,s,o)}return s}isInterrupted(){return!ry(this.getFiberRef(Or))}addInterruptedCause(n){const r=this.getFiberRef(Or);this.setFiberRef(Or,Ie(r,n))}processNewInterruptSignal(n){this.addInterruptedCause(n),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let n=!1;for(const r of this._children)r.tell(ho(ft(this.id()))),n=!0;return n}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const n=this._children.values();this._children=null;let r=!1;return Vi({while:()=>!r,body:()=>{const o=n.next();return o.done?$(()=>{r=!0}):hr(o.value.await)},step:()=>{}})}return null}reportExitValue(n){if(Xc(this.currentRuntimeFlags)){const r=this.getFiberRef(Ho),s=this.id().startTimeMillis,o=Date.now();switch(oO.unsafeUpdate(o-s,r),Na.unsafeUpdate(-1,r),n._tag){case Ve:{rO.unsafeUpdate(1,r);break}case Je:{sO.unsafeUpdate(1,r);break}}}if(n._tag==="Failure"){const r=this.getFiberRef($S);!Ni(n.cause)&&r._tag==="Some"&&this.log("Fiber terminated with an unhandled error",n.cause,r)}}setExitValue(n){this._exitValue=n,this.reportExitValue(n);for(let r=this._observers.length-1;r>=0;r--)this._observers[r](n);this._observers=[]}getLoggers(){return this.getFiberRef(gO)}log(n,r,s){const o=me(s)?s.value:this.getFiberRef(OS),i=this.getFiberRef(fO);if(M0(i,o))return;const a=this.getFiberRef(ES),u=this.getFiberRef(vS),l=this.getLoggers(),f=this.getFiberRefs();if(sf(l)>0){const d=yf(this.getFiberRef(us),Qi),p=new Date(d.unsafeCurrentTimeMillis());fm(f,()=>{for(const g of l)g.log({fiberId:this.id(),logLevel:o,message:n,cause:r,context:f,spans:a,annotations:u,date:p})})}}evaluateMessageWhileSuspended(n){switch(n._tag){case ac:return Aa;case oc:return this.processNewInterruptSignal(n.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(J(n.cause)),this._asyncInterruptor=null),$n;case cc:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(n.effect),$n;case ic:return n.onFiber(this,this._exitValue!==null?b0:S0(this.currentRuntimeFlags,this._asyncBlockingOn)),$n;default:return Ir(n)}}evaluateEffect(n){this.currentSupervisor.onResume(this);try{let r=lt(this.currentRuntimeFlags)&&this.isInterrupted()?J(this.getInterruptedCause()):n;for(;r!==null;){const s=r,o=this.runLoop(s);if(o===et){const i=tt.currentOp;tt.currentOp=null,i._op===Nr?Eb(this.currentRuntimeFlags)?(this.tell(dk()),this.tell(jt(St)),r=null):r=St:i._op===Cn&&(r=null)}else{this.currentRuntimeFlags=m(this.currentRuntimeFlags,Ib(Jo));const i=this.interruptAllChildren();i!==null?r=T(i,()=>o):(this._queue.length===0?this.setExitValue(o):this.tell(jt(o)),r=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(n){if(this._running)this.tell(jt(n));else{this._running=!0;const r=globalThis[pt];globalThis[pt]=this;try{this.evaluateEffect(n)}finally{this._running=!1,globalThis[pt]=r,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(n){this.tell(jt(n))}patchRuntimeFlags(n,r){const s=Kr(n,r);return globalThis[pt]=this,this.currentRuntimeFlags=s,s}initiateAsync(n,r){let s=!1;const o=i=>{s||(s=!0,this.tell(jt(i)))};lt(n)&&(this._asyncInterruptor=o);try{r(o)}catch(i){o(xe(Pe(i)))}}pushStack(n){this._stack.push(n),n._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const n=this._stack.pop();if(n)return n._op==="OnStep"&&this._steps.pop(),n}getNextSuccessCont(){let n=this.popStack();for(;n;){if(n._op!==to)return n;n=this.popStack()}}getNextFailCont(){let n=this.popStack();for(;n;){if(n._op!==Hr&&n._op!==Wr&&n._op!==Mr)return n;n=this.popStack()}}[(Au=bk,Nu=kk,dm)](n){return $(()=>_f(this.currentContext,n))}Left(n){return Se(n.left)}None(n){return Se(new ph)}Right(n){return X(n.right)}Some(n){return X(n.value)}Micro(n){return is(r=>{let s=r;const o=ik(Z0(n,this.currentContext));return o.addObserver(i=>{if(i._tag==="Success")return s(X(i.value));switch(i.cause._tag){case"Interrupt":return s(J(ft(fn)));case"Fail":return s(Se(i.cause.error));case"Die":return s(na(i.cause.defect))}}),is(i=>{s=a=>{i(Ge)},o.unsafeInterrupt()})})}[zu](n){const r=ye(()=>n.effect_instruction_i0()),s=this.getNextSuccessCont();return s!==void 0?(s._op in Rn||Ir(s),Rn[s._op](this,s,r)):(tt.currentOp=X(r),et)}[Ve](n){const r=n,s=this.getNextSuccessCont();return s!==void 0?(s._op in Rn||Ir(s),Rn[s._op](this,s,r.effect_instruction_i0)):(tt.currentOp=r,et)}[Je](n){const r=n.effect_instruction_i0,s=this.getNextFailCont();if(s!==void 0)switch(s._op){case to:case Gr:return lt(this.currentRuntimeFlags)&&this.isInterrupted()?J(Dc(r)):ye(()=>s.effect_instruction_i1(r));case"OnStep":return lt(this.currentRuntimeFlags)&&this.isInterrupted()?J(Dc(r)):X(J(r));case pi:return this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),lt(this.currentRuntimeFlags)&&this.isInterrupted()?J(Ie(r,this.getInterruptedCause())):J(r);default:Ir(s)}else return tt.currentOp=J(r),et}[Yu](n){return ye(()=>n.effect_instruction_i0(this,Kh(this.currentRuntimeFlags)))}Blocked(n){const r=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){const o=[],i=this._steps[this._steps.length-1];let a=this.popStack();for(;a&&a._op!=="OnStep";)o.push(a),a=this.popStack();this.setFiberRefs(i.refs),this.currentRuntimeFlags=i.flags;const u=u0(i.refs,r),l=jr(i.flags,s);return X(zf(n.effect_instruction_i0,Fe(f=>{for(;o.length>0;)f.pushStack(o.pop());return f.setFiberRefs(l0(f.id(),f.getFiberRefs())(u)),f.currentRuntimeFlags=Kr(l)(f.currentRuntimeFlags),n.effect_instruction_i1})))}return Bs(o=>T(wd(Yb(n.effect_instruction_i0)),()=>o(n.effect_instruction_i1)))}RunBlocked(n){return uO(n.effect_instruction_i0)}[Xn](n){const r=n.effect_instruction_i0,s=this.currentRuntimeFlags,o=Kr(s,r);if(lt(o)&&this.isInterrupted())return J(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,r),n.effect_instruction_i1){const i=jr(o,s);return this.pushStack(new Qb(i,n)),ye(()=>n.effect_instruction_i1(s))}else return St}[Hr](n){return this.pushStack(n),n.effect_instruction_i0}OnStep(n){return this.pushStack(n),n.effect_instruction_i0}[to](n){return this.pushStack(n),n.effect_instruction_i0}[Gr](n){return this.pushStack(n),n.effect_instruction_i0}[Cn](n){return this._asyncBlockingOn=n.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,n.effect_instruction_i0),tt.currentOp=n,et}[Nr](n){return this._isYielding=!1,tt.currentOp=n,et}[Wr](n){const r=n.effect_instruction_i0,s=n.effect_instruction_i1;return r()?(this.pushStack(n),s()):St}[Mr](n){return Rn[Mr](this,n,void 0)}[vs](n){return ye(()=>n.commit())}runLoop(n){let r=n;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&Ob)!==0&&this.currentSupervisor.onEffect(this,r),this._queue.length>0&&(r=this.drainQueueWhileRunning(this.currentRuntimeFlags,r)),!this._isYielding){this.currentOpCount+=1;const s=this.currentScheduler.shouldYield(this);if(s!==!1){this._isYielding=!0,this.currentOpCount=0;const o=r;r=T(Hi({priority:s}),()=>o)}}try{if(r=this.currentTracer.context(()=>{if(lO!==r[dn]._V){const s=this.getFiberRef(RS);if(s._tag==="Some"){const o=r[dn]._V;this.log(`Executing an Effect versioned ${o} with a Runtime of version ${yi()}, you may want to dedupe the effect dependencies, you can use the language service plugin to detect this at compile time: https://github.com/Effect-TS/language-service`,cn,s)}}return this[r._op](r)},this),r===et){const s=tt.currentOp;return s._op===Nr||s._op===Cn?et:(tt.currentOp=null,s._op===Ve||s._op===Je?s:J(Pe(s)))}}catch(s){r!==et&&!A(r,"_op")||!(r._op in this)?r=eS(`Not a valid effect: ${Wt(r)}`):PS(s)?r=J(Ie(Pe(s),ft(fn))):r=na(s)}}}}const fO=j("effect/FiberRef/currentMinimumLogLevel",()=>ke(N0("Info"))),hO=e=>lc(t=>{const n=r0(t.context,us);yf(n,Fh).unsafe.log(e.log(t))}),dO=j(Symbol.for("effect/Logger/defaultLogger"),()=>hO($k)),mO=j(Symbol.for("effect/Logger/tracerLogger"),()=>lc(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const i=ir(Hn(n,dr),Rh);if(i._tag==="None"||i.value._tag==="ExternalSpan")return;const a=_f(Hn(n,us),Qi),u={};for(const[l,f]of e)u[l]=f;u["effect.fiberId"]=f_(r),u["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(u["effect.cause"]=or(t,{renderErrorCause:!0})),i.value.event(Wt(Array.isArray(o)&&o.length===1?o[0]:o),a.unsafeCurrentTimeNanos(),u)})),gO=j(Symbol.for("effect/FiberRef/currentLoggers"),()=>SS(Mi(dO,mO))),pO=h(e=>zd(e[0]),(e,t,n)=>Fe(r=>{const s=(n==null?void 0:n.batching)===!0||(n==null?void 0:n.batching)==="inherit"&&r.getFiberRef(FS);return n!=null&&n.discard?Ia(n.concurrency,()=>Kt(Wo,n==null?void 0:n.concurrentFinalizers)(o=>s?It(e,(i,a)=>o(t(i,a)),!0,!1,1):Ds(e,(i,a)=>o(t(i,a)))),()=>Kt(zo,n==null?void 0:n.concurrentFinalizers)(o=>It(e,(i,a)=>o(t(i,a)),s,!1)),o=>Kt(Yo(o),n==null?void 0:n.concurrentFinalizers)(i=>It(e,(a,u)=>i(t(a,u)),s,!1,o))):Ia(n==null?void 0:n.concurrency,()=>Kt(Wo,n==null?void 0:n.concurrentFinalizers)(o=>s?Ca(e,1,(i,a)=>o(t(i,a)),!0):dt(e,(i,a)=>o(t(i,a)))),()=>Kt(zo,n==null?void 0:n.concurrentFinalizers)(o=>yO(e,(i,a)=>o(t(i,a)),s)),o=>Kt(Yo(o),n==null?void 0:n.concurrentFinalizers)(i=>Ca(e,o,(a,u)=>i(t(a,u)),s)))})),yO=(e,t,n)=>te(()=>{const r=Q(e),s=new Array(r.length);return Js(It(r,(i,a)=>T(t(i,a),u=>$(()=>s[a]=u)),n,!1),V(s))}),It=(e,t,n,r,s)=>Bs(o=>cS(i=>Fe(a=>{let u=Array.from(e).reverse(),l=u.length;if(l===0)return Ge;let f=0,d=!1;const p=s?Math.min(u.length,s):u.length,g=new Set,y=new Array,b=()=>g.forEach(k=>{k.currentScheduler.scheduleTask(()=>{k.unsafeInterruptAsFork(a.id())},0)}),_=new Array,v=new Array,K=new Array,O=()=>{const k=y.filter(({exit:U})=>U._tag==="Failure").sort((U,D)=>U.index<D.index?-1:U.index===D.index?0:1).map(({exit:U})=>U);return k.length===0&&k.push(St),k},P=(k,U=!1)=>{const D=ih(i(k)),C=bO(D,a,a.currentRuntimeFlags,uc);return a.currentScheduler.scheduleTask(()=>{U&&C.unsafeInterruptAsFork(a.id()),C.resume(D)},0),C},B=()=>{r||(l-=u.length,u=[]),d=!0,b()},I=n?rS:Zf,x=P(Vn(k=>{const U=(C,H)=>{C._op==="Blocked"?K.push(C):(y.push({index:H,exit:C}),C._op==="Failure"&&!d&&B())},D=()=>{if(u.length>0){const C=u.pop();let H=f++;const ie=()=>{const ce=u.pop();return H=f++,T(Hi(),()=>T(I(o(t(ce,H))),ge))},ge=ce=>u.length>0&&(U(ce,H),u.length>0)?ie():V(ce),Le=T(I(o(t(C,H))),ge),pe=P(Le);_.push(pe),g.add(pe),d&&pe.currentScheduler.scheduleTask(()=>{pe.unsafeInterruptAsFork(a.id())},0),pe.addObserver(ce=>{let je;if(ce._op==="Failure"?je=ce:je=ce.effect_instruction_i0,v.push(pe),g.delete(pe),U(je,H),y.length===l)k(V(he(ca(O(),{parallel:!0}),()=>St)));else if(K.length+y.length===l){const xt=O(),br=K.map(On=>On.effect_instruction_i0).reduce(Vf);k(V(zf(br,It([he(ca(xt,{parallel:!0}),()=>St),...K.map(On=>On.effect_instruction_i1)],On=>On,n,!0,s))))}else D()})}};for(let C=0;C<p;C++)D()}));return hr(Ji(nh(o(Zh(x))),yh({onFailure:k=>{B();const U=K.length+1,D=Math.min(typeof s=="number"?s:K.length,K.length),C=Array.from(K);return Vn(H=>{let ie=0,ge=0;const Le=(ce,je)=>xt=>{ie++,ie===U&&H(X(J(k))),C.length>0&&je&&pe()},pe=()=>{P(C.pop(),!0).addObserver(Le(ge,!0)),ge++};x.addObserver(Le(ge,!1)),ge++;for(let ce=0;ce<D;ce++)pe()})},onSuccess:()=>dt(v,k=>k.inheritAll)})))}))),Ca=(e,t,n,r)=>te(()=>{const s=Q(e),o=new Array(s.length);return Js(It(s,(a,u)=>we(n(a,u),l=>o[u]=l),r,!1,t),V(o))}),wd=e=>SO(e,uc),_O=(e,t,n,r=null)=>{const s=kd(e,t,n,r);return s.resume(e),s},bO=(e,t,n,r=null)=>kd(e,t,n,r),kd=(e,t,n,r=null)=>{const s=Ff(),o=t.getFiberRefs(),i=e0(o,s),a=new Sd(s,i,n),u=Hn(i,dr),l=a.currentSupervisor;return l.onStart(u,e,E(t),a),a.addObserver(d=>l.onEnd(d,a)),(r!==null?r:m(t.getFiberRef(Go),he(()=>t.scope()))).add(n,a),a},SO=(e,t)=>Fe((n,r)=>V(_O(e,n,r.runtimeFlags,t))),Pa=e=>mr(t=>Qe(ir(t,_r),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return T(Gs(n,zo),r=>mc(e,r))}}})),xa=e=>t=>mr(n=>Qe(ir(n,_r),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:T(Gs(r,Yo(e)),s=>mc(t,s))})),Kt=(e,t)=>n=>mr(r=>Qe(ir(r,_r),{onNone:()=>n(Z),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?Pa:e._tag==="Sequential"?La:xa(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(Pa));case"Sequential":return o(n(La));case"ParallelN":return o(n(xa(s.strategy.parallelism)))}}else return n(Z)}})),La=e=>mr(t=>Qe(ir(t,_r),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return T(Gs(n,Wo),r=>mc(e,r))}}})),_r=Pt("effect/Scope"),mc=h(2,(e,t)=>HS(e,bf(Ly(_r,t)))),wO=e=>kn(e,{differ:tO,fork:Ln}),ja=kS(Tb),kO=wO(Zs),vO=(e,t,n)=>th(r=>T(T(wd(rh(e)),s=>Vn(o=>{const i=t.map(l=>l.listeners.count),a=()=>{i.every(l=>l===0)&&t.every(l=>l.result.state.current._tag==="Pending"?!0:!!(l.result.state.current._tag==="Done"&&Ws(l.result.state.current.effect)&&l.result.state.current.effect._tag==="Failure"&&sy(l.result.state.current.effect.cause)))&&(u.forEach(l=>l()),n==null||n(),o(lS(s)))};s.addObserver(l=>{u.forEach(f=>f()),o(l)});const u=t.map((l,f)=>{const d=p=>{i[f]=p,a()};return l.listeners.addObserver(d),()=>l.listeners.removeObserver(d)});return a(),$(()=>{u.forEach(l=>l())})})),()=>te(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return Ds(s,o=>Gv(o.request,jS(r)))}))),OO=NS,EO=Gs,gc=e=>function(){if(arguments.length===1){const t=arguments[0];return(n,...r)=>e(t,n,...r)}return e.apply(this,arguments)},IO=gc((e,t,n)=>{const r=Ff(),s=[[dr,[[r,e.context]]]];n!=null&&n.scheduler&&s.push([zh,[[r,n.scheduler]]]);let o=s0(e.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(o=n.updateRefs(o,r));const i=new Sd(r,o,e.runtimeFlags);let a=t;n!=null&&n.scope&&(a=T(EO(n.scope,Mh),l=>Js(MS(l,th(f=>M(f,i.id())?Ge:uh(i,f))),Ji(t,f=>OO(l,f)))));const u=i.currentSupervisor;return u!==Zs&&(u.onStart(e.context,a,w(),i),i.addObserver(l=>u.onEnd(l,i))),uc.add(e.runtimeFlags,i),(n==null?void 0:n.immediate)===!1?i.resume(a):i.start(a),i}),TO=gc((e,t)=>{const n=AO(e)(t);if(n._tag==="Failure")throw MO(n.effect_instruction_i0);return n.effect_instruction_i0});class FO extends Error{constructor(n){super(`Fiber #${n.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`);c(this,"fiber");c(this,"_tag","AsyncFiberException");this.fiber=n,this.name=this._tag,this.stack=this.message}}const $O=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new FO(e);return Error.stackTraceLimit=t,n},mo=Symbol.for("effect/Runtime/FiberFailure"),Tr=Symbol.for("effect/Runtime/FiberFailure/Cause");var Cu,Pu;class RO extends Error{constructor(n){const r=hf(n)[0];super((r==null?void 0:r.message)||"An error has occurred");c(this,Pu);c(this,Cu);this[mo]=mo,this[Tr]=n,this.name=r?`(FiberFailure) ${r.name}`:"FiberFailure",r!=null&&r.stack&&(this.stack=r.stack)}toJSON(){return{_id:"FiberFailure",cause:this[Tr].toJSON()}}toString(){return"(FiberFailure) "+or(this[Tr],{renderErrorCause:!0})}[(Pu=mo,Cu=Tr,G)](){return this.toString()}}const MO=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new RO(e);return Error.stackTraceLimit=t,n},NO=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return aa(t.left);case"Right":return X(t.right);case"Some":return X(t.value);case"None":return aa(new ph)}},AO=gc((e,t)=>{const n=NO(t);if(n)return n;const r=new ak,s=IO(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();return o||LS(Bi($O(s),Yi(s)))});class CO{constructor(t,n,r){c(this,"context");c(this,"runtimeFlags");c(this,"fiberRefs");this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return F(this,arguments)}}const PO=e=>new CO(e.context,e.runtimeFlags,e.fiberRefs),xO=Bf(wn,Df,qf),LO=PO({context:xi(),runtimeFlags:xO,fiberRefs:o0()}),jO=TO(LO),KO=(function(){const e=Symbol.for("effect/Data/Error/plainArgs");return{BaseEffectError:class extends zi{constructor(n){super(n==null?void 0:n.message,n!=null&&n.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}.BaseEffectError})(),qO=e=>{const t={BaseEffectError:class extends KO{constructor(){super(...arguments);c(this,"_tag",e)}}};return t.BaseEffectError.prototype.name=e,t.BaseEffectError},DO=Ks,Ur=pO,ut=V,Fr=te,Re=Ge,pc=Vo,De=we,UO=Us,_t=cs,Ee=T,BO=qs,JO=oS,vd=jO,Oe=(e,t=[])=>({value:e,forest:t}),VO=e=>De(qt(e),t=>GO(t)),HO=e=>vd(VO(e)),GO=e=>e.value+Od(`
`,e.forest),Od=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const i=o===r-1;n+=e+(i?"":"")+" "+s.value,n+=Od(e+(r>1&&!i?"  ":"   "),s.forest)}return n},WO=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},zO=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},Ed=e=>"ast"in e?E(e.ast):w(),YO=e=>Ed(e).pipe(tr(Ig),Ee(t=>{const n=t(e);return it(n)?ut({message:n,override:!1}):DO(n)?De(n,r=>({message:r,override:!1})):it(n.message)?ut({message:n.message,override:n.override}):De(n.message,r=>({message:r,override:n.override}))})),yc=e=>t=>t._tag===e,QO=yc("Composite"),Ka=yc("Refinement"),qa=yc("Transformation"),_c=e=>YO(e).pipe(Ee(t=>!t.override&&(QO(e)||Ka(e)&&e.kind==="From"||qa(e)&&e.kind!=="Transformation")?qa(e)||Ka(e)?_c(e.issue):w():ut(t.message))),Id=e=>Ed(e).pipe(tr(Ng),Dm(t=>Os(t(e)))),XO=e=>_c(e).pipe(JO(()=>Id(e)),pc(()=>ut(e.message??`Expected ${String(e.ast)}, actual ${Xt(e.actual)}`))),$r=e=>he(Id(e),()=>String(e.ast)),ZO=e=>e.message??"is forbidden",eE=e=>e.message??"is unexpected",tE=e=>Tg(e.ast).pipe(Ee(t=>{const n=t();return it(n)?ut(n):n}),pc(()=>ut(e.message??"is missing"))),go=(e,t)=>BO(_c(e),{onFailure:t,onSuccess:n=>ut(Oe(n))}),qt=e=>{switch(e._tag){case"Type":return De(XO(e),Oe);case"Forbidden":return ut(Oe($r(e),[Oe(ZO(e))]));case"Unexpected":return ut(Oe(eE(e)));case"Missing":return De(tE(e),Oe);case"Transformation":return go(e,()=>De(qt(e.issue),t=>Oe($r(e),[Oe(WO(e.kind),[t])])));case"Refinement":return go(e,()=>De(qt(e.issue),t=>Oe($r(e),[Oe(zO(e.kind),[t])])));case"Pointer":return De(qt(e.issue),t=>Oe(pg(e.path),[t]));case"Composite":{const t=$r(e);return go(e,()=>Sl(e.issues)?De(Ur(e.issues,qt),n=>Oe(t,n)):De(qt(e.issues),n=>Oe(t,[n])))}}};class fe{constructor(t,n,r){c(this,"path");c(this,"actual");c(this,"issue");c(this,"_tag","Pointer");this.path=t,this.actual=n,this.issue=r}}class Da{constructor(t,n){c(this,"actual");c(this,"message");c(this,"_tag","Unexpected");this.actual=t,this.message=n}}class Mn{constructor(t,n){c(this,"ast");c(this,"message");c(this,"_tag","Missing");c(this,"actual");this.ast=t,this.message=n}}class z{constructor(t,n,r,s){c(this,"ast");c(this,"actual");c(this,"issues");c(this,"output");c(this,"_tag","Composite");this.ast=t,this.actual=n,this.issues=r,this.output=s}}class po{constructor(t,n,r,s){c(this,"ast");c(this,"actual");c(this,"kind");c(this,"issue");c(this,"_tag","Refinement");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class yo{constructor(t,n,r,s){c(this,"ast");c(this,"actual");c(this,"kind");c(this,"issue");c(this,"_tag","Transformation");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class st{constructor(t,n,r){c(this,"ast");c(this,"actual");c(this,"message");c(this,"_tag","Type");this.ast=t,this.actual=n,this.message=r}}class nE{constructor(t,n,r){c(this,"ast");c(this,"actual");c(this,"message");c(this,"_tag","Forbidden");this.ast=t,this.actual=n,this.message=r}}const Ua=Symbol.for("@effect/schema/ParseErrorTypeId");var xu;class rE extends qO("ParseError"){constructor(){super(...arguments);c(this,xu,Ua)}get message(){return this.toString()}toString(){return HO(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[(xu=Ua,G)](){return this.toJSON()}}const Td=e=>new rE({issue:e}),_o=h(2,(e,t)=>{const n=e;return n._tag==="Left"?n:n._tag==="Right"?t(n.right):Ee(e,t)}),sE=h(2,(e,t)=>{const n=e;return n._tag==="Left"?n:n._tag==="Right"?re(t(n.right)):De(e,t)}),bo=h(2,(e,t)=>{const n=e;return n._tag==="Left"?L(t(n.left)):n._tag==="Right"?n:UO(e,t)}),nt=e=>{const t=e;if(t._tag==="Left"||t._tag==="Right")return t},Fd=h(2,(e,t)=>{const n=e;return n._tag==="Left"?t(n.left):n._tag==="Right"?n:pc(e,t)}),$d=(e,t)=>t===void 0||Gt(t)?e:e===void 0?t:{...e,...t},Rd=(e,t,n)=>{const r=Ae(e,t);return(s,o)=>r(s,$d(n,o))},oE=(e,t,n)=>{const r=Rd(e,t,n);return(s,o)=>Am(r(s,o),Td)},iE=(e,t)=>Rd(e.ast,!0,t),cE=(e,t)=>oE(We(e.ast),!0,t),aE=j(Symbol.for("@effect/schema/Parser/decodeMemoMap"),()=>new WeakMap),uE=j(Symbol.for("@effect/schema/Parser/encodeMemoMap"),()=>new WeakMap),Ae=(e,t)=>{const n=t?aE:uE,r=n.get(e);if(r)return r;const s=lE(e,t),o=Ag(e),i=me(o)?(l,f)=>s(l,$d(f,o.value)):s,a=Cg(e),u=t&&me(a)?(l,f)=>Br(Fd(i(l,f),a.value),e,l,f):i;return n.set(e,u),u},So=e=>rt(Rg(e)),wo=e=>rt(Mg(e)),lE=(e,t)=>{switch(e._tag){case"Refinement":{const n=Ae(e.from,!0);return(r,s)=>{s=s??ro;const o=(s==null?void 0:s.errors)==="all",i=_o(Fd(n(r,s),a=>{const u=new po(e,r,"From",a);return o&&Lg(e)?Qe(e.filter(r,s,e),{onNone:()=>L(u),onSome:l=>L(new z(e,r,[u,new po(e,r,"Predicate",l)]))}):L(u)}),a=>Qe(e.filter(a,s,e),{onNone:()=>re(a),onSome:u=>L(new po(e,r,"Predicate",u))}));return Br(i,e,r,s)}}case"Transformation":{const n=mE(e.transformation),r=Ae(e.from,!0),s=Ae(e.to,!0);return(o,i)=>Br(_o(bo(r(o,i),a=>new yo(e,o,"Encoded",a)),a=>_o(bo(n(a,i??ro,e,o),u=>new yo(e,o,"Transformation",u)),u=>bo(s(u,i),l=>new yo(e,o,"Type",l)))),e,o,i)}case"Declaration":{const n=e.decodeUnknown(...e.typeParameters);return(r,s)=>Br(n(r,s??ro,e),e,r,s)}case"Literal":return ve(e,n=>n===e.literal);case"UniqueSymbol":return ve(e,n=>n===e.symbol);case"UndefinedKeyword":return ve(e,Vd);case"NeverKeyword":return ve(e,Hd);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return re;case"StringKeyword":return ve(e,it);case"NumberKeyword":return ve(e,Gt);case"BooleanKeyword":return ve(e,bs);case"BigIntKeyword":return ve(e,Ss);case"SymbolKeyword":return ve(e,vo);case"ObjectKeyword":return ve(e,zn);case"Enums":return ve(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=ip(e);return ve(e,r=>it(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(l=>Ae(l.type,t)),r=e.rest.map(l=>Ae(l.type,t));let s=e.elements.filter(l=>!l.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,i=e.elements.length>0?e.elements.map((l,f)=>f).join(" | "):"never",a=So(e),u=wo(e);return(l,f)=>{if(!Io(l))return L(new st(e,l));const d=(f==null?void 0:f.errors)==="all",p=[];let g=0;const y=[],b=l.length;for(let O=b;O<=o-1;O++){const P=new fe(O,l,new Mn(s[O-b]));if(d){p.push([g++,P]);continue}else return L(new z(e,l,P,y))}if(e.rest.length===0)for(let O=e.elements.length;O<=b-1;O++){const P=new fe(O,l,new Da(l[O],`is unexpected, expected: ${i}`));if(d){p.push([g++,P]);continue}else return L(new z(e,l,P,y))}let _=0,v;for(;_<n.length;_++)if(b<_+1){if(e.elements[_].isOptional)continue}else{const O=n[_],P=O(l[_],f),B=nt(P);if(B){if(ae(B)){const I=new fe(_,l,B.left);if(d){p.push([g++,I]);continue}else return L(new z(e,l,I,Ke(y)))}y.push([g++,B.right])}else{const I=g++,x=_;v||(v=[]),v.push(({es:k,output:U})=>Ee(_t(P),D=>{if(ae(D)){const C=new fe(x,l,D.left);return d?(k.push([I,C]),Re):L(new z(e,l,C,Ke(U)))}return U.push([I,D.right]),Re}))}}if(le(r)){const[O,...P]=r;for(;_<b-P.length;_++){const B=O(l[_],f),I=nt(B);if(I)if(ae(I)){const x=new fe(_,l,I.left);if(d){p.push([g++,x]);continue}else return L(new z(e,l,x,Ke(y)))}else y.push([g++,I.right]);else{const x=g++,k=_;v||(v=[]),v.push(({es:U,output:D})=>Ee(_t(B),C=>{if(ae(C)){const H=new fe(k,l,C.left);return d?(U.push([x,H]),Re):L(new z(e,l,H,Ke(D)))}else return D.push([x,C.right]),Re}))}}for(let B=0;B<P.length;B++)if(_+=B,!(b<_+1)){const I=P[B](l[_],f),x=nt(I);if(x){if(ae(x)){const k=new fe(_,l,x.left);if(d){p.push([g++,k]);continue}else return L(new z(e,l,k,Ke(y)))}y.push([g++,x.right])}else{const k=g++,U=_;v||(v=[]),v.push(({es:D,output:C})=>Ee(_t(I),H=>{if(ae(H)){const ie=new fe(U,l,H.left);return d?(D.push([k,ie]),Re):L(new z(e,l,ie,Ke(C)))}return C.push([k,H.right]),Re}))}}}const K=({es:O,output:P})=>Ar(O)?L(new z(e,l,Ke(O),Ke(P))):re(Ke(P));if(v&&v.length>0){const O=v;return Fr(()=>{const P={es:Nn(p),output:Nn(y)};return Ee(Ur(O,B=>B(P),{concurrency:a,batching:u,discard:!0}),()=>K(P))})}return K({output:y,es:p})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return ve(e,Gd);const n=[],r={},s=[];for(const f of e.propertySignatures)n.push([Ae(f.type,t),f]),r[f.name]=null,s.push(f.name);const o=e.indexSignatures.map(f=>[Ae(f.parameter,t),Ae(f.type,t),f.parameter]),i=vt.make(e.indexSignatures.map(f=>f.parameter).concat(s.map(f=>vo(f)?new qg(f):new Kg(f)))),a=Ae(i,t),u=So(e),l=wo(e);return(f,d)=>{if(!Yd(f))return L(new st(e,f));const p=(d==null?void 0:d.errors)==="all",g=[];let y=0;const b=(d==null?void 0:d.onExcessProperty)==="error",_=(d==null?void 0:d.onExcessProperty)==="preserve",v={};let K;if(b||_){K=Pr(f);for(const I of K){const x=nt(a(I,d));if(ae(x))if(b){const k=new fe(I,f,new Da(f[I],`is unexpected, expected: ${String(i)}`));if(p){g.push([y++,k]);continue}else return L(new z(e,f,k,v))}else v[I]=f[I]}}let O;const P=(d==null?void 0:d.exact)===!0;for(let I=0;I<n.length;I++){const x=n[I][1],k=x.name,U=Object.prototype.hasOwnProperty.call(f,k);if(!U){if(x.isOptional)continue;if(P){const ie=new fe(k,f,new Mn(x));if(p){g.push([y++,ie]);continue}else return L(new z(e,f,ie,v))}}const D=n[I][0],C=D(f[k],d),H=nt(C);if(H){if(ae(H)){const ie=new fe(k,f,U?H.left:new Mn(x));if(p){g.push([y++,ie]);continue}else return L(new z(e,f,ie,v))}v[k]=H.right}else{const ie=y++,ge=k;O||(O=[]),O.push(({es:Le,output:pe})=>Ee(_t(C),ce=>{if(ae(ce)){const je=new fe(ge,f,U?ce.left:new Mn(x));return p?(Le.push([ie,je]),Re):L(new z(e,f,je,pe))}return pe[ge]=ce.right,Re}))}}for(let I=0;I<o.length;I++){const x=o[I],k=x[0],U=x[1],D=_l(f,x[2]);for(const C of D){const H=nt(k(C,d));if(H&&ht(H)){const ie=U(f[C],d),ge=nt(ie);if(ge)if(ae(ge)){const Le=new fe(C,f,ge.left);if(p){g.push([y++,Le]);continue}else return L(new z(e,f,Le,v))}else Object.prototype.hasOwnProperty.call(r,C)||(v[C]=ge.right);else{const Le=y++,pe=C;O||(O=[]),O.push(({es:ce,output:je})=>Ee(_t(ie),xt=>{if(ae(xt)){const br=new fe(pe,f,xt.left);return p?(ce.push([Le,br]),Re):L(new z(e,f,br,je))}else return Object.prototype.hasOwnProperty.call(r,C)||(je[C]=xt.right),Re}))}}}}const B=({es:I,output:x})=>{if(Ar(I))return L(new z(e,f,Ke(I),x));if((d==null?void 0:d.propertyOrder)==="original"){const k=K||Pr(f);for(const D of s)k.indexOf(D)===-1&&k.push(D);const U={};for(const D of k)Object.prototype.hasOwnProperty.call(x,D)&&(U[D]=x[D]);return re(U)}return re(x)};if(O&&O.length>0){const I=O;return Fr(()=>{const x={es:Nn(g),output:Object.assign({},v)};return Ee(Ur(I,k=>k(x),{concurrency:u,batching:l,discard:!0}),()=>B(x))})}return B({es:g,output:v})}}case"Union":{const n=hE(e.types),r=Pr(n.keys),s=r.length,o=new Map;for(let u=0;u<e.types.length;u++)o.set(e.types[u],Ae(e.types[u],t));const i=So(e)??1,a=wo(e);return(u,l)=>{const f=[];let d=0,p=[];if(s>0)if(fE(u))for(let b=0;b<s;b++){const _=r[b],v=n.keys[_].buckets;if(Object.prototype.hasOwnProperty.call(u,_)){const K=String(u[_]);if(Object.prototype.hasOwnProperty.call(v,K))p=p.concat(v[K]);else{const O=vt.make(n.keys[_].literals);f.push([d++,new z(new Xr([new Qr(_,O,!1,!0)],[]),u,new fe(_,u,new st(O,u[_])))])}}else{const K=vt.make(n.keys[_].literals),O=new Qr(_,K,!1,!0);f.push([d++,new z(new Xr([O],[]),u,new fe(_,u,new Mn(O)))])}}else f.push([d++,new st(e,u)]);n.otherwise.length>0&&(p=p.concat(n.otherwise));let g;for(let b=0;b<p.length;b++){const _=p[b],v=o.get(_)(u,l),K=!g||g.length===0?nt(v):void 0;if(K){if(ht(K))return K;f.push([d++,K.left])}else{const O=d++;g||(g=[]),g.push(P=>Fr(()=>"finalResult"in P?Re:Ee(_t(v),B=>(ht(B)?P.finalResult=B:P.es.push([O,B.left]),Re))))}}const y=b=>Ar(b)?b.length===1&&b[0][1]._tag==="Type"?L(b[0][1]):L(new z(e,u,Ke(b))):L(new st(e,u));if(g&&g.length>0){const b=g;return Fr(()=>{const _={es:Nn(f)};return Ee(Ur(b,v=>v(_),{concurrency:i,batching:a,discard:!0}),()=>"finalResult"in _?_.finalResult:y(_.es))})}return y(f)}}case"Suspend":{const n=bl(()=>Ae(ql(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},fE=e=>typeof e=="object"&&e!==null,ve=(e,t)=>n=>t(n)?re(n):L(new st(e,n)),An=(e,t)=>{switch(e._tag){case"Declaration":{const n=Pg(e);if(me(n))return An(n.value);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=jc(s.type);xc(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"TupleType":{const n=[];for(let r=0;r<e.elements.length;r++){const s=e.elements[r],o=jc(s.type);xc(o)&&!s.isOptional&&n.push([r,o])}return n}case"Refinement":return An(e.from);case"Suspend":return An(e.f());case"Transformation":return An(e.from)}return[]},hE=(e,t)=>{const n={},r=[];for(let s=0;s<e.length;s++){const o=e[s],i=An(o);if(i.length>0)for(let a=0;a<i.length;a++){const[u,l]=i[a],f=String(l.literal);n[u]=n[u]||{buckets:{},literals:[]};const d=n[u].buckets;if(Object.prototype.hasOwnProperty.call(d,f)){if(a<i.length-1)continue;d[f].push(o),n[u].literals.push(l)}else{d[f]=[o],n[u].literals.push(l);break}}else r.push(o)}return{keys:n,otherwise:r}},Br=(e,t,n,r)=>{const s=nt(e);if(s)return s;if((r==null?void 0:r.isEffectAllowed)===!0)return e;try{return vd(_t(e))}catch{return L(new nE(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))}},dE=([e],[t])=>e>t?1:e<t?-1:0;function Ke(e){return e.sort(dE).map(t=>t[1])}const mE=(e,t)=>{switch(e._tag){case"FinalTransformation":return e.decode;case"ComposeTransformation":return re;case"TypeLiteralTransformation":return n=>{let r=re(n);for(const s of e.propertySignatureTransformations){const[o,i]=[s.from,s.to],a=s.decode;r=sE(r,l=>{const f=a(Object.prototype.hasOwnProperty.call(l,o)?E(l[o]):w());return delete l[o],me(f)&&(l[i]=f.value),l})}return r}}},gE=Symbol.for("@effect/schema/EquivalenceHookId"),pE=Symbol.for("@effect/schema/PrettyHookId"),Ba=Symbol.for("@effect/schema/Schema"),bc=e=>{var t,n,r;return n=Ba,t=Ba,r=class{constructor(){c(this,n,Ja)}static annotations(o){return bc(Nd(this.ast,o))}static pipe(){return F(this,arguments)}static toString(){return String(e)}},c(r,"Type"),c(r,"Encoded"),c(r,"Context"),c(r,t,Ja),c(r,"ast",e),r},Ja={_A:e=>e,_I:e=>e,_R:e=>e},Md=e=>{if(!e)return{};const t={},n=Object.getOwnPropertySymbols(e);for(const s of n)t[s]=e[s];if(e.typeId!==void 0){const s=e.typeId;typeof s=="object"?(t[Pc]=s.id,t[s.id]=s.annotation):t[Pc]=s}const r=(s,o)=>{e[s]!==void 0&&(t[o]=e[s])};return r("message",wl),r("missingMessage",kl),r("identifier",vl),r("title",pn),r("description",Si),r("examples",Sg),r("default",wg),r("documentation",vg),r("jsonSchema",kg),r("arbitrary",up),r("pretty",pE),r("equivalence",gE),r("concurrency",Ol),r("batching",El),r("parseIssueTitle",Il),r("parseOptions",Tl),r("decodingFallback",Fl),t},Nd=(e,t)=>ql(e,Md(t)),yE=(e,t)=>{const n=iE(e,t);return(r,s)=>Rm(n(r,s),Td)};class Ad extends bc(Wg){}const _E=Symbol.for("@effect/schema/refine"),Cd=(e,t,n)=>{var r,s,o;return o=class extends(s=bc(n),r=_E,s){static annotations(a){return Cd(this.from,this.filter,Nd(this.ast,a))}},c(o,r,e),c(o,"from",e),c(o,"filter",t),c(o,"make",(a,u)=>vE(u)?a:cE(o)(a)),o},Va=(e,t,n)=>{if(bs(e))return e?w():E(new st(t,n));if(it(e))return E(new st(t,n,e));if(e!==void 0){if("_tag"in e)return E(e);const r=new st(t,n,e.message);return E(le(e.path)?new fe(e.path,n,r):r)}return w()},bE=(e,t,n)=>{if(gg(e))return Va(e,t,n);if(le(e)){const r=fg(e,s=>Va(s,t,n));if(le(r))return E(r.length===1?r[0]:new z(t,n,r))}return w()};function Pd(e,t){return n=>{function r(o,i,a){return bE(e(o,i,a),a,o)}const s=new Kl(n.ast,r,Md(t));return Cd(n,r,s)}}const SE=ap,xd=(e,t)=>n=>n.pipe(Pd(r=>r.length>=e,{typeId:SE,description:`a string at least ${e} character(s) long`,jsonSchema:{minLength:e},...t})),wE=Symbol.for("@effect/schema/TypeId/Pattern"),kE=(e,t)=>n=>{const r=e.source;return n.pipe(Pd(s=>(e.lastIndex=0,e.test(s)),{typeId:{id:wE,annotation:{regex:e}},description:`a string matching the pattern ${r}`,jsonSchema:{pattern:r},arbitrary:()=>s=>s.stringMatching(e),...t}))},Ld=e=>xd(1,{description:"a non empty string",...e}),vE=e=>bs(e)?e:(e==null?void 0:e.disableValidation)??!1,LE={title:"Examples/Form Validation with Effect Schema"},OE=Ad.pipe(Ld({message:()=>"Email is required"}),kE(/^[^\s@]+@[^\s@]+\.[^\s@]+$/,{message:()=>"Please enter a valid email address"})),EE=Ad.pipe(Ld({message:()=>"Password is required"}),xd(8,{message:()=>"Password must be at least 8 characters"}));function Ha(e,t){const r=yE(e)(t);if(ae(r)){const s=r.left.issue;return"message"in s&&typeof s.message=="string"?s.message:"Invalid"}return null}const IE=`import { Schema } from '@effect/schema';
import { Either } from 'effect';

// Validation schemas
const EmailSchema = Schema.String.pipe(
  Schema.nonEmptyString({ message: () => 'Email is required' }),
  Schema.pattern(/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/, {
    message: () => 'Please enter a valid email address',
  })
);

const PasswordSchema = Schema.String.pipe(
  Schema.nonEmptyString({ message: () => 'Password is required' }),
  Schema.minLength(8, { message: () => 'Password must be at least 8 characters' })
);

function validateField(schema, value) {
  const decode = Schema.decodeUnknownEither(schema);
  const result = decode(value);

  if (Either.isLeft(result)) {
    const issue = result.left.issue;
    if ('message' in issue && typeof issue.message === 'string') {
      return issue.message;
    }
    return 'Invalid';
  }
  return null;
}

// Get references to form elements
const emailField = document.querySelector('#email-field');
const passwordField = document.querySelector('#password-field');
const confirmField = document.querySelector('#confirm-field');
const submitButton = document.querySelector('#submit-button');

// Update button state based on validation
const updateButtonState = () => {
  const hasErrors =
    emailField.error ||
    passwordField.error ||
    confirmField.error ||
    !emailField.value ||
    !passwordField.value ||
    !confirmField.value;
  submitButton.disabled = hasErrors;
};

// Email validation
emailField.addEventListener('input', () => {
  const error = validateField(EmailSchema, emailField.value);
  emailField.error = !!error;
  emailField.errorText = error ?? '';
  updateButtonState();
});

// Password validation
passwordField.addEventListener('input', () => {
  const error = validateField(PasswordSchema, passwordField.value);
  passwordField.error = !!error;
  passwordField.errorText = error ?? '';
  // Re-validate confirm field when password changes
  if (confirmField.value) {
    const confirmError =
      confirmField.value !== passwordField.value ? 'Passwords do not match' : null;
    confirmField.error = !!confirmError;
    confirmField.errorText = confirmError ?? '';
  }
  updateButtonState();
});

// Confirm password validation
confirmField.addEventListener('input', () => {
  const error =
    confirmField.value !== passwordField.value ? 'Passwords do not match' : null;
  confirmField.error = !!error;
  confirmField.errorText = error ?? '';
  updateButtonState();
});
`,Rr={parameters:{docs:{source:{code:IE,language:"typescript"}}},render:()=>{const e="registration-form-"+Math.random().toString(36).slice(2,9);return requestAnimationFrame(()=>{const t=document.getElementById(e);if(!t||t.dataset.validationSetup)return;t.dataset.validationSetup="true";const n=t.querySelector("#email-field"),r=t.querySelector("#password-field"),s=t.querySelector("#confirm-field"),o=t.querySelector("#submit-button"),i=t.querySelector("#result");if(!n||!r||!s||!o||!i)return;const a=()=>{const l=n.error||r.error||s.error||!n.value||!r.value||!s.value;o.disabled=l},u=l=>l.stopPropagation();n.addEventListener("keydown",u),r.addEventListener("keydown",u),s.addEventListener("keydown",u),n.addEventListener("input",()=>{const l=Ha(OE,n.value);n.error=!!l,n.errorText=l??"",a()}),r.addEventListener("input",()=>{const l=Ha(EE,r.value);if(r.error=!!l,r.errorText=l??"",s.value){const f=s.value!==r.value?"Passwords do not match":null;s.error=!!f,s.errorText=f??""}a()}),s.addEventListener("input",()=>{const l=s.value!==r.value?"Passwords do not match":null;s.error=!!l,s.errorText=l??"",a()}),o.addEventListener("click",()=>{i.textContent=`Registration successful for: ${n.value}`,i.style.display="block"})}),qd`
      <div
        id=${e}
        style="display: flex; flex-direction: column; gap: 16px; max-width: 360px;"
      >
        <h3 style="margin: 0;">Registration Form</h3>
        <md-text-field
          id="email-field"
          label="Email"
          type="email"
        ></md-text-field>
        <md-text-field
          id="password-field"
          label="Password"
          type="password"
          supporting-text="At least 8 characters"
        ></md-text-field>
        <md-text-field
          id="confirm-field"
          label="Confirm Password"
          type="password"
        ></md-text-field>
        <md-button
          id="submit-button"
          variant="filled"
          disabled
        >
          Register
        </md-button>
        <div
          id="result"
          style="display: none; padding: 12px; border-radius: 8px; background: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container);"
        ></div>
      </div>
    `}};var Lu,ju,Ku;Rr.parameters={...Rr.parameters,docs:{...(Lu=Rr.parameters)==null?void 0:Lu.docs,source:{originalSource:`{
  parameters: {
    docs: {
      source: {
        code: sourceCode,
        language: 'typescript'
      }
    }
  },
  render: () => {
    const containerId = 'registration-form-' + Math.random().toString(36).slice(2, 9);
    requestAnimationFrame(() => {
      const container = document.getElementById(containerId);
      if (!container || container.dataset.validationSetup) return;
      container.dataset.validationSetup = 'true';
      const emailField = container.querySelector<TextField>('#email-field');
      const passwordField = container.querySelector<TextField>('#password-field');
      const confirmField = container.querySelector<TextField>('#confirm-field');
      const submitButton = container.querySelector<HTMLButtonElement>('#submit-button');
      const resultDiv = container.querySelector<HTMLElement>('#result');
      if (!emailField || !passwordField || !confirmField || !submitButton || !resultDiv) return;
      const updateButtonState = () => {
        const hasErrors = emailField.error || passwordField.error || confirmField.error || !emailField.value || !passwordField.value || !confirmField.value;
        submitButton.disabled = hasErrors;
      };

      // Stop keydown events from propagating to Storybook (prevents shortcut conflicts)
      const stopPropagation = (e: Event) => e.stopPropagation();
      emailField.addEventListener('keydown', stopPropagation);
      passwordField.addEventListener('keydown', stopPropagation);
      confirmField.addEventListener('keydown', stopPropagation);
      emailField.addEventListener('input', () => {
        const error = validateField(EmailSchema, emailField.value);
        emailField.error = !!error;
        emailField.errorText = error ?? '';
        updateButtonState();
      });
      passwordField.addEventListener('input', () => {
        const error = validateField(PasswordSchema, passwordField.value);
        passwordField.error = !!error;
        passwordField.errorText = error ?? '';
        if (confirmField.value) {
          const confirmError = confirmField.value !== passwordField.value ? 'Passwords do not match' : null;
          confirmField.error = !!confirmError;
          confirmField.errorText = confirmError ?? '';
        }
        updateButtonState();
      });
      confirmField.addEventListener('input', () => {
        const error = confirmField.value !== passwordField.value ? 'Passwords do not match' : null;
        confirmField.error = !!error;
        confirmField.errorText = error ?? '';
        updateButtonState();
      });
      submitButton.addEventListener('click', () => {
        resultDiv.textContent = \`Registration successful for: \${emailField.value}\`;
        resultDiv.style.display = 'block';
      });
    });
    return html\`
      <div
        id=\${containerId}
        style="display: flex; flex-direction: column; gap: 16px; max-width: 360px;"
      >
        <h3 style="margin: 0;">Registration Form</h3>
        <md-text-field
          id="email-field"
          label="Email"
          type="email"
        ></md-text-field>
        <md-text-field
          id="password-field"
          label="Password"
          type="password"
          supporting-text="At least 8 characters"
        ></md-text-field>
        <md-text-field
          id="confirm-field"
          label="Confirm Password"
          type="password"
        ></md-text-field>
        <md-button
          id="submit-button"
          variant="filled"
          disabled
        >
          Register
        </md-button>
        <div
          id="result"
          style="display: none; padding: 12px; border-radius: 8px; background: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container);"
        ></div>
      </div>
    \`;
  }
}`,...(Ku=(ju=Rr.parameters)==null?void 0:ju.docs)==null?void 0:Ku.source}}};const jE=["RegistrationForm"];export{Rr as RegistrationForm,jE as __namedExportsOrder,LE as default};
